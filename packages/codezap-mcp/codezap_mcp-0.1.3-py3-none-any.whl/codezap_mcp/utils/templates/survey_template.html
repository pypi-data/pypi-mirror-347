<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeZap MCP Server</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&family=Geist:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Geist', 'Noto Sans SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        h1 { 
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .question-container { 
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .question-title { 
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        .options-container { 
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        .option { 
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .option:hover { 
            background-color: #e9e9e9;
        }
        .option.selected { 
            background-color: #3498db;
            color: white;
            border-color: #2980b9;
        }
        .skip { 
            background-color: #f8f9fa;
            color: #6c757d;
        }
        .skip.selected { 
            background-color: #6c757d;
            color: white;
        }
        .submit-container { 
            text-align: center;
            margin-top: 30px;
        }
        .submit-btn { 
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 12px 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .submit-btn:hover { 
            background-color: #27ae60;
        }
        .additional-requirements { 
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .additional-requirements h2 { 
            font-size: 1.2em;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        textarea { 
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Geist', 'Noto Sans SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            resize: vertical;
        }
    </style>
</head>
<body>
    <h1>Clarify product requirements</h1>
    <div id="questions-container">
        <!-- Questions will be dynamically loaded via JavaScript -->
    </div>
    
    <div class="additional-requirements">
        <h2>Additional Requirements or Notes (Optional)</h2>
        <textarea id="additional-requirements"></textarea>
    </div>
    
    <div class="submit-container">
        <button id="submit-btn" class="submit-btn">Submit</button>
    </div>

    <script>
        // Execute when the page is fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            const questionsContainer = document.getElementById('questions-container');
            const submitBtn = document.getElementById('submit-btn');
            
            // Store user-selected options
            const selectedOptions = {};  // Format: { questionId: { questionId, question, optionIndex, option } }
            
            // Fetch question and option data from the server
            fetch('/api/data')
                .then(response => response.json())
                .then(response => {
                    const questions = response.data;
                    
                    // Iterate through questions and create HTML elements
                    Object.keys(questions).forEach(questionId => {
                        const questionData = questions[questionId];
                        const questionTitle = questionData.question;
                        const options = questionData.options;
                        
                        // Create question container
                        const questionContainer = document.createElement('div');
                        questionContainer.className = 'question-container';
                        questionContainer.dataset.questionId = questionId;
                        
                        // Create question title
                        const questionTitleElement = document.createElement('div');
                        questionTitleElement.className = 'question-title';
                        questionTitleElement.textContent = questionTitle;
                        questionContainer.appendChild(questionTitleElement);
                        
                        // Create options container
                        const optionsContainer = document.createElement('div');
                        optionsContainer.className = 'options-container';
                        
                        // Add options
                        options.forEach((option, index) => {
                            const optionElement = document.createElement('div');
                            optionElement.className = 'option';
                            if (option === 'Skip') {
                                optionElement.classList.add('skip');
                            }
                            optionElement.textContent = option;
                            optionElement.dataset.optionIndex = index;
                            optionElement.dataset.option = option;
                            optionsContainer.appendChild(optionElement);
                            
                            // Add click event
                            optionElement.addEventListener('click', function() {
                                const options = this.parentElement.querySelectorAll('.option');
                                
                                // Remove selected state from all options
                                options.forEach(opt => opt.classList.remove('selected'));
                                
                                // If current option is already selected, deselect it
                                const isSkip = option === 'Skip';
                                if (selectedOptions[questionId] && selectedOptions[questionId].optionIndex === index) {  
                                    delete selectedOptions[questionId];
                                    this.classList.remove('selected');
                                } else {  
                                    // Otherwise, select the current option
                                    this.classList.add('selected');
                                    selectedOptions[questionId] = {  
                                        questionId: questionId,
                                        question: questionTitle,
                                        optionIndex: index,
                                        option: option,
                                        skip: isSkip
                                    };
                                }
                            });
                        });
                        
                        // Add options container to question container
                        questionContainer.appendChild(optionsContainer);
                        
                        // Add question container to questions list
                        questionsContainer.appendChild(questionContainer);
                    });
                });

            // Submit button click event
            submitBtn.addEventListener('click', function() {  
                // Convert selected options to array
                const selectedArray = Object.values(selectedOptions);
                // Get additional requirements text
                const additionalRequirements = document.getElementById('additional-requirements').value;
                
                fetch('/api/callback', {  
                    method: 'POST',
                    headers: {  
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        selections: selectedArray,
                        additionalRequirements: additionalRequirements
                    })
                })
                .then(response => response.json())
                .then(data => {  
                    if (data.status === 'success') {  
                        // Close the window
                        window.close();
                    }
                })
                .catch(error => console.error('Error:', error));
            });
        });
    </script>
</body>
</html>
