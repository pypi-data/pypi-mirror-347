import"../chunks/CWj6FrbW.js";import{p as Ze,a as s,b as g,s as l,f as S,c as $e,d as u,e as t,g as e,u as _e,r as v,h as et}from"../chunks/DJ4-OfXg.js";import{s as tt}from"../chunks/DpcWkFIJ.js";import{i as w}from"../chunks/DU3kBxd7.js";import{t as h,a as f,c as at}from"../chunks/BBucZf18.js";import{r as rt}from"../chunks/D3kiUGTp.js";import{d as ot}from"../chunks/Bcqz6BHu.js";import{b as nt}from"../chunks/CITlhhU1.js";import{S as st,d as I}from"../chunks/pVhPhZzS.js";import{A as ee}from"../chunks/HX9qiWDz.js";import{R as ue}from"../chunks/Cjb3PMTS.js";import{g as it,f as ke,B as lt}from"../chunks/BSJu0SI5.js";import{g as A}from"../chunks/CqS7hfz2.js";var ct=h("<h3>Cumulation</h3> <!>",1),dt=h("<h3>Technology</h3> <!>",1),_t=h("<h3>Carrier</h3> <!>",1),ut=h("<!> <!>",1),vt=h("<h3>Location</h3> <!>",1),mt=h('<div class="row"><div class="col-6"><h3>Aggregation</h3> <!></div> <div class="col-6"><h3>Normalisation</h3> <!></div></div> <!>',1),gt=h('<div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">Data Selection</button></h2> <div id="collapseThree" class="accordion-collapse collapse show"><div class="accordion-body"><!> <h3>Year</h3> <!></div></div></div>'),ft=h('<div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">Variable Selection</button></h2> <div id="collapseTwo" class="accordion-collapse collapse show"><div class="accordion-body"><h3>Subdivision</h3> <input type="checkbox" class="btn-check" id="btn-check-outlined" autocomplete="off"> <label class="btn btn-outline-primary" for="btn-check-outlined"> </label><br> <!></div></div></div> <!>',1),pt=h('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),ht=h('<div class="text-center">No data with this selection.</div>'),bt=h('<h2>Emissions</h2> <div class="z-1 position-relative"><div class="filters"><div class="accordion" id="accordionExample"><div class="accordion-item solution-selection"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">Solution Selection</button></h2> <div id="collapseOne" class="accordion-collapse collapse show"><div class="accordion-body"><!></div></div></div> <!></div></div></div> <div class="mt-4"><!></div>',1);function Lt(ze,Ae){Ze(Ae,!0);let J,K,E=s(g([])),ve=s(g([])),T=s(g([])),M=s(g([])),Ee=g(["Annual","Cumulative"]),a=s(null),Q=s(g([]));const Te=["not_normalized","normalized"];let R=s("not_normalized"),te=s(g([])),U=s(g([])),ae=s(g({})),p=s(g([])),L=s(null),Y=s(null),x=s(!0),j=s(g([])),F=s(g([])),V=s("technology"),q=s(g([])),C=s(!1),b=s(!1),me=s("plot"),je=_e(()=>({type:"bar",data:{datasets:e(p)},options:{responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`Emissions [${e(j).length>0?e(ae)[e(j)[0]]:""}]`}}}}}));function ge(){t(L,null),t(Y,null),t(p,[],!0),t(j,[],!0),t(F,[],!0),e(x)&&(t(Y,"technology_carrier"),Ce())}function re(){var r,o,d;return e(x)?A("carbon_emissions_carrier",(r=e(a))==null?void 0:r.version):e(L)=="Annual"?A("carbon_emissions_annual",(o=e(a))==null?void 0:o.version):A("carbon_emissions_cumulative",(d=e(a))==null?void 0:d.version)}async function Ce(){var i,c,z;if(!e(a))return;t(b,!0);let r=await I(e(a).solution_name,A("carbon_emissions_technology",(i=e(a))==null?void 0:i.version),e(a).scenario_name,e(a).detail.system.reference_year,e(a).detail.system.interval_between_years),o=await I(e(a).solution_name,A("carbon_emissions_carrier",(c=e(a))==null?void 0:c.version),e(a).scenario_name,e(a).detail.system.reference_year,e(a).detail.system.interval_between_years),d=new Set,_=new Set,m=new Set;for(let n of r.data.data)_.add(n.technology),m.add(n.location);for(let n of o.data.data){if(d.add(n.carrier),m.add(n.node),Object.hasOwn(n,"node")){let P=Object.getOwnPropertyDescriptor(n,"node");if(P===void 0)continue;Object.defineProperty(n,"location",P)}delete n.node}J=it("technology_carrier",[["carrier",o.data],["technology",r.data]]),t(q,[..._],!0),t(E,[...d],!0),t(M,[...m],!0),(z=o.unit)!=null&&z.data&&t(ae,Object.fromEntries(o.unit.data.map(n=>[n.carrier,n[0]||n.units])),!0),t(b,!1),fe()}async function Be(){var d,_,m,i;let r=re();if(r===null)return;if(t(b,!0),r==A("carbon_emissions_annual",(d=e(a))==null?void 0:d.version))K=(await I(e(a).solution_name,A("carbon_emissions_annual_limit",(_=e(a))==null?void 0:_.version),e(a).scenario_name,e(a).detail.system.reference_year,e(a).detail.system.interval_between_years)).data;else{let c=await I(e(a).solution_name,A("carbon_emissions_budget",(m=e(a))==null?void 0:m.version),e(a).scenario_name,e(a).detail.system.reference_year,e(a).detail.system.interval_between_years);if(c.data)for(const z of e(T))c.data.data[0][z]=c.data.data[0][e(T)[0]];K=c.data}const o=await I(e(a).solution_name,r,e(a).scenario_name,e(a).detail.system.reference_year,e(a).detail.system.interval_between_years);J=o.data,(i=o.unit)!=null&&i.data&&t(ae,Object.fromEntries(o.unit.data.map(c=>[c.carrier,c[0]||c.units])),!0),t(b,!1)}async function Le(){await Be(),fe(),k()}function fe(){t(te,["location"],!0),e(Y)&&t(te,["location",e(Y)],!0),t(j,e(E),!0),t(F,e(q),!0),t(U,e(M),!0),t(V,"location"),t(R,"not_normalized"),t(b,!1),k()}function k(){var m;if(!J)return;let r={},o={};e(x)&&(e(V)!="location"?(r.location=e(M),o.technology_carrier=e(F).concat(e(j))):(r.technology_carrier=e(q).concat(e(E)),o.location=e(U)));let d=e(T).filter(i=>!e(Q).includes(i));if(t(p,ke(J.data,r,o,d,e(R)=="normalized"),!0),e(p).length==0)return;if(e(p).length==1&&!e(x)&&(e(p)[0].label=re()),K){let i=ke(K.data,r,o,d,e(R)=="normalized");i.length>0&&(i[0].label=e(L)=="Annual"?"Annual Emissions Limit":"Carbon Emissions Budget",i[0].type="line",t(p,e(p).concat(i),!0))}let _=e(a).solution_name.split(".");t(me,[_[(_==null?void 0:_.length)-1],(m=e(a))==null?void 0:m.scenario_name,re()].join("_"),!0)}var pe=bt(),oe=l(S(pe),2),he=u(oe),be=u(he),ne=u(be),ye=l(u(ne),2),we=u(ye),Pe=u(we);const De=_e(()=>!e(C)&&!e(b));st(Pe,{solution_selected:()=>{ge(),t(Q,e(T),!0)},get enabled(){return e(De)},get carriers(){return e(E)},set carriers(r){t(E,r,!0)},get nodes(){return e(ve)},set nodes(r){t(ve,r,!0)},get years(){return e(T)},set years(r){t(T,r,!0)},get selected_solution(){return e(a)},set selected_solution(r){t(a,r,!0)},get loading(){return e(C)},set loading(r){t(C,r,!0)}}),v(we),v(ye),v(ne);var Ne=l(ne,2);{var Re=r=>{var o=ft(),d=S(o),_=l(u(d),2),m=u(_),i=l(u(m),2);rt(i),i.__change=ge;var c=l(i,2),z=u(c,!0);v(c);var n=l(c,3);{var P=O=>{var D=ct(),W=l(S(D),2);const X=_e(()=>!e(b)&&!e(C));ue(W,{get options(){return Ee},selection_changed:Le,get enabled(){return e(X)},get selected_option(){return e(L)},set selected_option(Z){t(L,Z,!0)}}),f(O,D)};w(n,O=>{e(x)||O(P)})}v(m),v(_),v(d);var qe=l(d,2);{var Ge=O=>{var D=gt(),W=l(u(D),2),X=u(W),Z=u(X);{var He=N=>{var Oe=mt(),se=S(Oe),ie=u(se),Je=l(u(ie),2);ue(Je,{get options(){return e(te)},selection_changed:k,get selected_option(){return e(V)},set selected_option(y){t(V,y,!0)}}),v(ie);var Se=l(ie,2),Ke=l(u(Se),2);ue(Ke,{options:Te,selection_changed:k,get selected_option(){return e(R)},set selected_option(y){t(R,y,!0)}}),v(Se),v(se);var Me=l(se,2);{var Qe=y=>{var G=ut(),$=S(G);{var le=B=>{var H=dt(),ce=l(S(H),2);ee(ce,{get elements(){return e(q)},selection_changed:k,get selected_elements(){return e(F)},set selected_elements(de){t(F,de,!0)}}),f(B,H)};w($,B=>{e(q).length>0&&B(le)})}var We=l($,2);{var Xe=B=>{var H=_t(),ce=l(S(H),2);ee(ce,{get elements(){return e(E)},selection_changed:k,get selected_elements(){return e(j)},set selected_elements(de){t(j,de,!0)}}),f(B,H)};w(We,B=>{e(E).length>0&&B(Xe)})}f(y,G)},Ue=y=>{var G=vt(),$=l(S(G),2);ee($,{get elements(){return e(M)},selection_changed:k,get selected_elements(){return e(U)},set selected_elements(le){t(U,le,!0)}}),f(y,G)};w(Me,y=>{e(V)!="location"?y(Qe):y(Ue,!1)})}f(N,Oe)};w(Z,N=>{e(x)&&N(He)})}var Ie=l(Z,4);ee(Ie,{get elements(){return e(T)},selection_changed:N=>{k()},get selected_elements(){return e(Q)},set selected_elements(N){t(Q,N,!0)}}),v(X),v(W),v(D),f(O,D)};w(qe,O=>{!e(b)&&(e(L)||e(Y))&&O(Ge)})}et(()=>{i.disabled=e(b)||e(C),tt(z,e(x)?"on":"off")}),nt(i,()=>e(x),O=>t(x,O)),f(r,o)};w(Ne,r=>{!e(C)&&e(a)&&r(Re)})}v(be),v(he),v(oe);var xe=l(oe,2),Ye=u(xe);{var Fe=r=>{var o=pt();f(r,o)},Ve=(r,o)=>{{var d=_=>{var m=at(),i=S(m);{var c=n=>{var P=ht();f(n,P)},z=n=>{lt(n,{get config(){return e(je)},get plot_name(){return e(me)}})};w(i,n=>{e(p).length==0||e(p)[0].data.length==0?n(c):n(z,!1)})}f(_,m)};w(r,_=>{e(p)!=null&&e(a)!=null&&_(d)},o)}};w(Ye,r=>{e(C)||e(b)?r(Fe):r(Ve,!1)})}v(xe),f(ze,pe),$e()}ot(["change"]);export{Lt as component};
