import"../chunks/CWj6FrbW.js";import{p as at,a as r,b as j,s as f,f as ie,c as lt,d as p,e as a,g as e,u as B,r as g,h as Fe}from"../chunks/DJ4-OfXg.js";import{s as We}from"../chunks/DpcWkFIJ.js";import{i as k,b as Be}from"../chunks/DU3kBxd7.js";import{e as ot,i as rt}from"../chunks/DiyBIa6G.js";import{t as h,a as m}from"../chunks/BBucZf18.js";import{d as it}from"../chunks/Bcqz6BHu.js";import{S as st,b as G,c as nt}from"../chunks/pVhPhZzS.js";import{A as dt}from"../chunks/HX9qiWDz.js";import{f as J,B as Ee}from"../chunks/BSJu0SI5.js";import{D as Pe}from"../chunks/CDFaqrA9.js";import{g as Q}from"../chunks/CqS7hfz2.js";import{T as ct}from"../chunks/D0AwY0i3.js";var ut=h("<option> </option>"),_t=h('<h3>Carrier</h3> <select class="form-select"><!> </select> <h3>Year</h3> <!> <h3>Smoothing Window Size</h3> <!>',1),vt=h('<div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">Data Selection</button></h2> <div id="collapseThree" class="accordion-collapse collapse show"><div class="accordion-body"><h3>Technology Subdivision</h3> <!> <h3>Node</h3> <!></div></div></div>'),pt=h('<div class="accordion-item variable-selction"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">Variable Selection</button></h2> <div id="collapseTwo" class="accordion-collapse collapse show"><div class="accordion-body"><!></div></div></div> <!>',1),gt=h('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),ft=h('<div class="text-center">No technologies with this selection.</div>'),mt=h('<div class="text-center">No carriers with this selection.</div>'),ht=h('<div class="text-center">No solution selected.</div>'),bt=h('<div class="text-center">No data with this selection.</div>'),yt=h('<div class="text-center">No locations with this selection.</div>'),wt=h('<div class="text-center">No data with this selection.</div>'),xt=h("<!> <!>",1),St=h('<h2>The Energy Balance Storage</h2> <div class="position-relative z-1"><div class="filters"><div class="accordion" id="accordionExample"><div class="accordion-item solution-selection"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">Solution Selection</button></h2> <div id="collapseOne" class="accordion-collapse collapse show"><div class="accordion-body"><!></div></div></div> <!></div></div></div> <div class="mt-4"><!></div>',1);function Et(Ze,Me){at(Me,!0);let x=r(null),se=r(null),ne=r(null),L=r(null),I=r(null),C=r(null),U=r(null),X=r(null),be=r(null),ye=r(null),A=r(j([])),E=r(j([])),F=r(j([])),we=r(j({})),n=r(null);const He="storage_level";let P=r(null),$=[],Z=r(j([])),D=r(!1),S=r(!1),de=r(""),Ke="",ce=r(!0),V=r(j([])),ee=r("");const Le=["Hourly","Daily","Weekly","Monthly"].map(t=>({label:t,value:t}));let ue=r("Hourly"),te=r(void 0),ae=r(void 0),Y=r(j([])),_e=r(j([])),M=r(j([])),xe=B(()=>e(F).length>0?e(we)[e(F)[0]]:""),Ie=B(()=>({type:"line",data:{datasets:e(Y),labels:e(M)},options:{animation:!1,normalized:!0,elements:{point:{radius:0}},responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Time"}},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:`Storage Level [${e(xe)}]`}}},borderWidth:1,plugins:{zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x",onPanComplete:t=>{var l;(l=e(ae))==null||l.zoom_rect(t.chart.scales.x.min,t.chart.scales.x.max)}},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x",onZoomComplete:t=>{var l;(l=e(ae))==null||l.zoom_rect(t.chart.scales.x.min,t.chart.scales.x.max)}},limits:{x:{minRange:10}}}}}})),Ve=B(()=>({counter:1,type:"line",data:{datasets:e(_e),labels:e(M)},options:{animation:!1,normalized:!0,elements:{point:{radius:0}},responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Time"}},y:{type:"linear",stacked:!0,beginAtZero:!0,title:{display:!0,text:`Storage Flow [${e(xe)}]`}}},borderWidth:1,plugins:{zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x",onPanComplete:t=>{var l;(l=e(te))==null||l.zoom_rect(t.chart.scales.x.min,t.chart.scales.x.max)}},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x",onZoomComplete:t=>{var l;(l=e(te))==null||l.zoom_rect(t.chart.scales.x.min,t.chart.scales.x.max)}},limits:{x:{minRange:10}}}}}}));function Se(){a(Z,e(E),!0),$=e(F)}async function ze(){var O;if(a(x,null),e(n)===null)return;let t=Math.floor((parseInt(e(ee))-e(n).detail.system.reference_year)/e(n).detail.system.interval_between_years),l=1;switch(e(ue)){case"Daily":l=24;break;case"Weekly":l=168;break;case"Monthly":l=720;break}const[c,b,o,_,u]=await Promise.all([G(e(n).solution_name,Q("storage_level"),e(n).scenario_name,t,l),G(e(n).solution_name,Q("flow_storage_charge"),e(n).scenario_name,t,l),G(e(n).solution_name,Q("flow_storage_discharge"),e(n).scenario_name,t,l),G(e(n).solution_name,Q("flow_storage_spillage"),e(n).scenario_name,t,l),G(e(n).solution_name,Q("flow_storage_inflow"),e(n).scenario_name,t,l)]);a(x,c.data,!0),(O=c.unit)!=null&&O.data&&a(we,Object.fromEntries(c.unit.data.map(v=>[v.technology,v[0]||v.units])),!0),a(se,b.data,!0),a(ne,o.data,!0),a(L,_.data,!0),a(I,u.data,!0)}async function Ye(){e(n)!==null&&(a(S,!0),a(ee,e(V).length>0?e(V)[0].toString():"",!0),await ze(),qe(),Ce(),ke(),Se(),le(),a(S,!1))}async function ve(){a(S,!0),await ze(),Ce(),ke(),Se(),le(),a(S,!1)}function ke(){a(E,Array.from(new Set(e(x).data.map(t=>t.node))),!0),a(Z,e(E),!0)}function qe(){if(a(A,[],!0),!e(x))return;let t=Array.from(e(x).data.map(l=>l.technology));e(x).data.forEach(l=>{let c=l.technology,b=e(n).detail.reference_carrier[c];!e(A).includes(b)&&t.includes(l.technology)&&e(A).push(b)}),e(A).length>0&&a(P,e(A)[0],!0)}function Ce(){let t=Array.from(new Set(e(x).data.map(l=>l.technology)));a(F,t.filter(l=>{var c;return((c=e(n))==null?void 0:c.detail.reference_carrier[l])==e(P)}),!0),$=e(F)}function le(){var b;if(e(Z).length==0||$.length==0||e(x)===null||e(se)===null||e(ne)===null||e(I)===null||e(L)===null){a(Y,[],!0),a(M,[],!0),a(de,"");return}let t={},l={};if(t.technology=$,l.node=e(Z),a(C,J(e(x).data,t,l,[],!1,"line","").map(o=>({...o,fill:"origin"})),!0),a(U,J(e(se).data,t,l,[],!1,"line","_charge").map(o=>({...o,stepped:!0,fill:"origin"})),!0),a(X,J(e(ne).data,t,l,[],!1,"line","_discharge").map(o=>{let _={};for(let u in o.data)_[u]=o.data[u]>0?-o.data[u]:o.data[u];return{data:_,label:o.label,type:o.type,stepped:!0,fill:"origin"}}),!0),a(ye,J(e(L).data,t,l,[],!1,"line","_spillage").map(o=>{let _={};for(let u in o.data)_[u]=o.data[u]>0?-o.data[u]:o.data[u];return{data:_,label:o.label,type:o.type,stepped:!0,fill:"origin"}}),!0),a(be,J(e(I).data,t,l,[],!1,"line","_inflow").map(o=>({...o,stepped:!0,fill:"origin"})),!0),a(Y,e(C),!0),a(_e,e(U).concat(e(X)).concat(e(be)).concat(e(ye)),!0),a(M,Object.keys(e(C)[0].data),!0),e(ce))a(Y,e(C),!0),a(M,Object.keys(e(C)[0].data),!0);else{let o={};for(const s in e(C)[0].data)o[s]=e(C).map(i=>i.data[s]).reduce((i,d)=>i+d,0);let _={};for(const s in e(U)[0].data)_[s]=e(U).map(i=>i.data[s]).reduce((i,d)=>i+d,0);let u={};for(const s in e(X)[0].data)u[s]=e(X).map(i=>i.data[s]).reduce((i,d)=>i+d,0);let O={};for(const s in e(I).data[0])O[s]=e(I).data.map(i=>i.data[s]).reduce((i,d)=>i+d,0);let v={};for(const s in e(L).data[0])v[s]=e(L).data.map(i=>i.data[s]).reduce((i,d)=>i+d,0);a(Y,[{data:Object.values(o),label:"Storage level",type:"line",borderColor:"black",fill:"origin",stepped:!0}],!0),a(_e,[{data:Object.values(_),label:"Flow Storage Charge",type:"line",borderColor:"blue",stepped:!0},{data:Object.values(u),label:"Flow Storage Discharge",type:"line",borderColor:"red",stepped:!0},{data:Object.values(O),label:"Flow Storage Discharge",type:"line",borderColor:"red",stepped:!0},{data:Object.values(v),label:"Flow Storage Discharge",type:"line",borderColor:"red",stepped:!0}],!0),a(M,Object.keys(o),!0)}let c=e(n).solution_name.split(".");a(de,[c[(c==null?void 0:c.length)-1],(b=e(n))==null?void 0:b.scenario_name,He,e(P)].join("_"),!0)}var De=St(),pe=f(ie(De),2),Oe=p(pe),Te=p(Oe),ge=p(Te),je=f(p(ge),2),Ae=p(je),Ge=p(Ae);const Je=B(()=>!e(S)&&!e(D));st(Ge,{solution_selected:Ye,get enabled(){return e(Je)},get selected_solution(){return e(n)},set selected_solution(t){a(n,t,!0)},get loading(){return e(D)},set loading(t){a(D,t,!0)},get years(){return e(V)},set years(t){a(V,t,!0)}}),g(Ae),g(je),g(ge);var Qe=f(ge,2);{var Ue=t=>{var l=pt(),c=ie(l),b=f(p(c),2),o=p(b),_=p(o);{var u=s=>{var i=_t(),d=f(ie(i),2);d.__change=ve;var y=p(d);ot(y,17,()=>e(A),rt,(w,z)=>{var T=ut(),oe={},me=p(T,!0);g(T),Fe(()=>{oe!==(oe=e(z))&&(T.value=(T.__value=e(z))??""),We(me,e(z))}),m(w,T)});var N=f(y);g(d);var H=f(d,4);const W=B(()=>e(V).map(w=>({label:w.toString(),value:w.toString()}))),R=B(()=>!e(S)&&!e(D));Pe(H,{get options(){return e(W)},selection_changed:ve,get enabled(){return e(R)},get selected_option(){return e(ee)},set selected_option(w){a(ee,w,!0)}});var q=f(H,4);const fe=B(()=>!e(S)&&!e(D));Pe(q,{options:Le,selection_changed:ve,get enabled(){return e(fe)},get selected_option(){return e(ue)},set selected_option(w){a(ue,w,!0)}}),Fe(()=>{d.disabled=e(S)||e(D),We(N,` disabled=${(e(S)||e(D))??""}`)}),nt(d,()=>e(P),w=>a(P,w)),m(s,i)};k(_,s=>{e(A).length>0&&s(u)})}g(o),g(b),g(c);var O=f(c,2);{var v=s=>{var i=vt(),d=f(p(i),2),y=p(d),N=f(p(y),2);ct(N,{change:le,get value(){return e(ce)},set value(W){a(ce,W,!0)}});var H=f(N,4);dt(H,{get elements(){return e(E)},selection_changed:le,get selected_elements(){return e(Z)},set selected_elements(W){a(Z,W,!0)}}),g(y),g(d),g(i),m(s,i)};k(O,s=>{e(x)&&e(P)&&e(F).length>0&&e(E).length>0&&s(v)})}m(t,l)};k(Qe,t=>{!e(D)&&e(n)&&t(Ue)})}g(Te),g(Oe),g(pe);var Ne=f(pe,2),Xe=p(Ne);{var $e=t=>{var l=gt();m(t,l)},et=(t,l)=>{{var c=o=>{var _=ft();m(o,_)},b=(o,_)=>{{var u=v=>{var s=mt();m(v,s)},O=(v,s)=>{{var i=y=>{var N=ht();m(y,N)},d=(y,N)=>{{var H=R=>{var q=bt();m(R,q)},W=(R,q)=>{{var fe=z=>{var T=yt();m(z,T)},w=(z,T)=>{{var oe=K=>{var re=wt();m(K,re)},me=K=>{var re=xt(),Re=ie(re);Be(Ee(Re,{get config(){return e(Ie)},get plot_name(){return e(de)},zoom:!0}),he=>a(te,he,!0),()=>e(te));var tt=f(Re,2);Be(Ee(tt,{get config(){return e(Ve)},get plot_name(){return Ke},zoom:!0}),he=>a(ae,he,!0),()=>e(ae)),m(K,re)};k(z,K=>{e(C).length==0?K(oe):K(me,!1)},T)}};k(R,z=>{e(E).length==0?z(fe):z(w,!1)},q)}};k(y,R=>{e(C)==null?R(H):R(W,!1)},N)}};k(v,y=>{e(n)==null?y(i):y(d,!1)},s)}};k(o,v=>{e(A).length==0?v(u):v(O,!1)},_)}};k(t,o=>{e(F).length==0?o(c):o(b,!1)},l)}};k(Xe,t=>{e(D)||e(S)?t($e):t(et,!1)})}g(Ne),m(Ze,De),lt()}it(["change"]);export{Et as component};
