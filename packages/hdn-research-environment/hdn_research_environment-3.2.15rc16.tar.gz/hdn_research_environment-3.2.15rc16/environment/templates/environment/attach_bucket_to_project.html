{% extends 'base.html' %}

{% load static %}

{% block title %}Attach Bucket to Project{% endblock %}

{% block local_css %}
<link rel="stylesheet" type="text/css" href="{% static 'environment/css/environment-base.css' %}">
<style>
  .project-card {
    margin-bottom: 15px;
    cursor: pointer;
    transition: all 0.2s ease;
    border: 1px solid #dee2e6;
    border-radius: 8px;
  }
  .project-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }
  .project-card.selected {
    border-color: #0d6efd;
    background-color: rgba(13, 110, 253, 0.05);
  }
  .project-card-header {
    padding: 12px 15px;
    border-bottom: 1px solid #dee2e6;
    font-weight: 600;
  }
  .project-card-body {
    padding: 15px;
  }
</style>
{% endblock %}

{% block content %}
<div class="container">
  {% include "message_snippet.html" %}
  
  <div class="jumbotron">
    <h1>Attach Bucket to Project</h1>
    <p class="lead">
      Associate the bucket <strong>{{ bucket_name }}</strong> with a project for easier access management.
    </p>
  </div>

  <div class="card">
    <div class="card-body">
      <h5 class="card-title">Bucket Details</h5>
      <div class="row mb-4">
        <div class="col-md-6">
          <p><strong>Bucket Name:</strong> {{ bucket_name }}</p>
        </div>
        <div class="col-md-6">
          <p><strong>Workspace ID:</strong> {{ workspace_project_id }}</p>
        </div>
      </div>

      <h5 class="card-title">Select Project</h5>
      
      {% if form.project.field.queryset.exists %}
        <form action="{% url 'attach_bucket_to_project' workspace_project_id=workspace_project_id bucket_name=bucket_name %}" method="post">
          {% csrf_token %}
            
            {% if form.non_field_errors %}
              <div class="alert alert-danger">
                {% for error in form.non_field_errors %}
                  {{ error }}
                {% endfor %}
              </div>
            {% endif %}
            
            {% for field in form %}
              <div class="form-group">
                <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                {{ field }}
                {% if field.help_text %}
                  <small class="form-text text-muted">{{ field.help_text|safe }}</small>
                {% endif %}
                {% if field.errors %}
                  <div class="invalid-feedback d-block">
                    {% for error in field.errors %}
                      {{ error }}
                    {% endfor %}
                  </div>
                {% endif %}
              </div>
            {% endfor %}
            
            <button class="btn btn-primary mt-3" type="submit">
              Attach bucket
            </button>

          </form>
      {% else %}
        <div class="alert alert-warning">
          <p>You don't have any projects available for attachment. Possible reasons:</p>
          <ul>
            <li>You don't have access to any projects</li>
            <li>All your accessible projects already have buckets attached to them</li>
          </ul>
          <p>Please create a new project or detach an existing bucket from a project first.</p>
          
          <div class="mt-3">
            <a href="{% url 'research_environments' %}" class="btn btn-primary">
              Back to Environments
            </a>
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}