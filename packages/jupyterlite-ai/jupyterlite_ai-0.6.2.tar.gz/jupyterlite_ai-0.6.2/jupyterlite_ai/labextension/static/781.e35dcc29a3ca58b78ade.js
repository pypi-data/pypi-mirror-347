"use strict";(self.webpackChunk_jupyterlite_ai=self.webpackChunk_jupyterlite_ai||[]).push([[781,827],{50781:(e,t,n)=>{n.r(t),n.d(t,{ActiveCellManager:()=>o,AttachButton:()=>Te,AttachmentOpenerRegistry:()=>Fe,Avatar:()=>we,CancelButton:()=>Ve,Chat:()=>He,ChatBody:()=>Le,ChatCommandRegistry:()=>et,ChatInput:()=>D,ChatMessage:()=>ye,ChatMessageHeader:()=>be,ChatMessages:()=>_e,ChatModel:()=>ze,ChatWidget:()=>Xe,CodeToolbar:()=>q,ContrastingTooltip:()=>M,CopyButton:()=>$,IAttachmentOpenerRegistry:()=>Oe,IChatCommandRegistry:()=>tt,InputModel:()=>le,InputToolbarRegistry:()=>De,JlThemeProvider:()=>_,MarkdownRenderer:()=>ie,MessageToolbar:()=>ne,Navigation:()=>xe,ScrollContainer:()=>se,SelectionWatcher:()=>Ke,SendButton:()=>je,TooltippedButton:()=>S,TooltippedIconButton:()=>z,Writers:()=>Ee,buildChatSidebar:()=>Qe,buildErrorWidget:()=>qe,chatIcon:()=>U,includeSelectionIcon:()=>G,readIcon:()=>J,replaceCellIcon:()=>Z,useChatCommands:()=>P});var a=n(6118),i=n(35263),s=n(74602);class o{constructor(e){var t,n;this._onMainAreaChanged=()=>{var e,t;const n=null!==(t=null===(e=this._notebookTracker.currentWidget)||void 0===e?void 0:e.isVisible)&&void 0!==t&&t;n!==this._notebookVisible&&(this._notebookVisible=n,this._available=!!this._activeCell&&this._notebookVisible,this._availabilityChanged.emit(this._available))},this._onActiveCellChanged=(e,t)=>{var n;this._activeCell!==t&&(null===(n=this._activeCell)||void 0===n||n.model.stateChanged.disconnect(this._cellStateChange),this._activeCell=t,null==t||t.ready.then((()=>{var e;null===(e=this._activeCell)||void 0===e||e.model.stateChanged.connect(this._cellStateChange),this._available=!!this._activeCell&&this._notebookVisible,this._availabilityChanged.emit(this._available)})))},this._cellStateChange=(e,t)=>{var n;if("executionCount"===t.name){const e=null===(n=this._activeCell)||void 0===n?void 0:n.model.sharedModel,t=this._activeCellError;let a=null;e&&"outputs"in e&&(a=e.outputs.find((e=>"error"===e.output_type))||null),t!==a&&(this._activeCellError=a,this._activeCellErrorChanged.emit(this._activeCellError))}},this._notebookVisible=!1,this._activeCell=null,this._available=!1,this._activeCellError=null,this._availabilityChanged=new s.Signal(this),this._activeCellErrorChanged=new s.Signal(this),this._notebookTracker=e.tracker,this._notebookTracker.activeCellChanged.connect(this._onActiveCellChanged),null===(t=e.shell.currentChanged)||void 0===t||t.connect(this._onMainAreaChanged),e.shell instanceof a.LabShell&&(null===(n=e.shell.layoutModified)||void 0===n||n.connect(this._onMainAreaChanged)),this._onMainAreaChanged()}get available(){return this._available}get activeCellError(){return this._activeCellError}get availabilityChanged(){return this._availabilityChanged}get activeCellErrorChanged(){return this._activeCellErrorChanged}getContent(e=!1){var t;const n=null===(t=this._notebookTracker.activeCell)||void 0===t?void 0:t.model.sharedModel;if(!n)return null;if(!e)return{type:n.cell_type,source:n.getSource()};const a=this._activeCellError;return a?{type:"code",source:n.getSource(),error:{name:a.ename,value:a.evalue,traceback:a.traceback}}:null}insertAbove(e){const t=this._notebookTracker.currentWidget;t&&t.isVisible&&(i.NotebookActions.insertAbove(t.content),this.replace(e))}insertBelow(e){const t=this._notebookTracker.currentWidget;t&&t.isVisible&&(i.NotebookActions.insertBelow(t.content),this.replace(e))}async replace(e){var t;const n=this._notebookTracker.currentWidget;if(!n||!n.isVisible)return;const a=this._notebookTracker.activeCell;a&&(await a.ready,null===(t=a.editor)||void 0===t||t.model.sharedModel.setSource(e))}}var l=n(92659),r=n(20448),c=n(77346),d=n(12067),u=n(67413);const h=(0,n(27553).A)("MuiBox",["root"]),m=(0,u.A)({defaultClassName:h.root,generateClassName:d.A.generate});var g=n(93345),p=n.n(g),v=n(46749),f=n(72363);function C(e){return getComputedStyle(document.body).getPropertyValue(e).trim()}function _(e){const[t,n]=(0,g.useState)((0,v.A)());return(0,g.useEffect)((()=>{var t;async function a(){n(await async function(){await async function(){for(;!document.body.hasAttribute("data-jp-theme-light");)await new Promise((e=>setTimeout(e,100)))}();const e=document.body.getAttribute("data-jp-theme-light");return(0,v.A)({spacing:4,components:{MuiButton:{defaultProps:{size:"small"}},MuiFilledInput:{defaultProps:{margin:"dense"}},MuiFormControl:{defaultProps:{margin:"dense",size:"small"}},MuiFormHelperText:{defaultProps:{margin:"dense"}},MuiIconButton:{defaultProps:{size:"small"}},MuiInputBase:{defaultProps:{margin:"dense",size:"small"}},MuiInputLabel:{defaultProps:{margin:"dense"}},MuiListItem:{defaultProps:{dense:!0}},MuiOutlinedInput:{defaultProps:{margin:"dense"}},MuiFab:{defaultProps:{size:"small"}},MuiTable:{defaultProps:{size:"small"}},MuiTextField:{defaultProps:{margin:"dense",size:"small"}},MuiToolbar:{defaultProps:{variant:"dense"}}},palette:{background:{paper:C("--jp-layout-color1"),default:C("--jp-layout-color1")},mode:"true"===e?"light":"dark",primary:{main:C("--jp-brand-color1"),light:C("--jp-brand-color2"),dark:C("--jp-brand-color0")},error:{main:C("--jp-error-color1"),light:C("--jp-error-color2"),dark:C("--jp-error-color0")},warning:{main:C("--jp-warn-color1"),light:C("--jp-warn-color2"),dark:C("--jp-warn-color0")},success:{main:C("--jp-success-color1"),light:C("--jp-success-color2"),dark:C("--jp-success-color0")},text:{primary:C("--jp-ui-font-color1"),secondary:C("--jp-ui-font-color2"),disabled:C("--jp-ui-font-color3")}},shape:{borderRadius:2},typography:{fontFamily:C("--jp-ui-font-family"),fontSize:12,htmlFontSize:16,button:{textTransform:"capitalize"}}})}())}a(),null===(t=e.themeManager)||void 0===t||t.themeChanged.connect(a)}),[]),p().createElement(f.A,{theme:t},e.children)}var b=n(40180),y=n(42235),E=n(67262),x=n(28919),w=n(39781);const M=(0,c.styled)((({className:e,...t})=>p().createElement(c.Tooltip,{...t,arrow:!0,classes:{popper:e}})))((({theme:e})=>({[`& .${c.tooltipClasses.tooltip}`]:{backgroundColor:e.palette.common.black,color:e.palette.common.white,boxShadow:e.shadows[1],fontSize:11},[`& .${c.tooltipClasses.arrow}`]:{color:e.palette.common.black}}))),A="jp-chat-tooltipped-wrap";function S(e){var t;return p().createElement(M,{title:e.tooltip,placement:null!==(t=e.placement)&&void 0!==t?t:"top",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[0,-8]}}]}}},p().createElement("span",{style:{cursor:"default"},className:A},p().createElement(c.Button,{...e.buttonProps,onClick:e.onClick,disabled:e.disabled,sx:{lineHeight:0,...e.disabled&&{opacity:.5},...e.sx},"aria-label":e["aria-label"]},e.children)))}const I=(0,g.createContext)(void 0),k="jp-chat-attachments",j="jp-chat-attachment",N="jp-chat-attachment-clickable",R="jp-chat-attachment-remove";function W(e){return p().createElement(c.Box,{className:k},e.attachments.map((t=>p().createElement(T,{...e,attachment:t}))))}function T(e){const t="Remove attachment",n=(0,g.useContext)(I);return p().createElement(c.Box,{className:j},p().createElement("span",{className:(null==n?void 0:n.get(e.attachment.type))?N:"",onClick:()=>{var t;return null===(t=null==n?void 0:n.get(e.attachment.type))||void 0===t?void 0:t(e.attachment)}},e.attachment.value),e.onRemove&&p().createElement(S,{onClick:()=>e.onRemove(e.attachment),tooltip:t,buttonProps:{size:"small",title:t,className:R},sx:{minWidth:"unset",padding:"0",color:"inherit"}},p().createElement(w.A,null)))}function P(e,t){const[n,a]=(0,g.useState)(!1),[i,s]=(0,g.useState)(!1),[o,l]=(0,g.useState)([]);return(0,g.useEffect)((()=>{async function n(n,i){const o=null==t?void 0:t.getProviders();if(!o)return;if(!(null==i?void 0:i.length))return l([]),s(!1),void a(!1);let r=[];for(const t of o)try{r=r.concat(await t.getChatCommands(e))}catch(e){console.error(`Error when getting chat commands from command provider '${t.id}': `,e)}r&&s(!0),l(r)}return e.currentWordChanged.connect(n),()=>{e.currentWordChanged.disconnect(n)}}),[e]),{autocompleteProps:{open:i,options:o,getOptionLabel:e=>e.name,renderOption:(e,t,n,a)=>{const{key:i,...s}=e,o=p().createElement("span",null,"object"==typeof t.icon?p().createElement(t.icon.react,null):t.icon);return p().createElement(c.Box,{key:i,component:"li",...s},o,p().createElement("p",{className:"jp-chat-command-name"},t.name),t.description&&p().createElement(p().Fragment,null,p().createElement("span",null," - "),p().createElement("p",{className:"jp-chat-command-description"},t.description)))},filterOptions:e=>e,value:null,autoHighlight:!0,freeSolo:!0,disableClearable:!0,onChange:(n,a,i)=>{"selectOption"===i&&t&&e.currentWord&&(a.replaceWith?e.replaceCurrentWord(a.replaceWith):t.handleChatCommand(a,e))},onHighlightChange:(e,t)=>{a(!!t)},onClose:()=>{a(!1),s(!1)}},menu:{open:i,highlighted:n}}}const B="jp-chat-input-container",V="jp-chat-input-toolbar";function D(e){var t;const{model:n,toolbarRegistry:a}=e,[i,s]=(0,g.useState)(n.value),o=(0,g.useRef)(),l=P(n,e.chatCommandRegistry),[r,d]=(0,g.useState)(null!==(t=n.config.sendWithShiftEnter)&&void 0!==t&&t),[u,h]=(0,g.useState)(n.attachments),[m,v]=(0,g.useState)([]);(0,g.useEffect)((()=>{var e,t;n.valueChanged.connect(((e,t)=>{s(t)}));const a=(e,t)=>{var n;d(null!==(n=t.sendWithShiftEnter)&&void 0!==n&&n)};n.configChanged.connect(a);const i=()=>{o.current&&o.current.focus()};null===(e=n.focusInputSignal)||void 0===e||e.connect(i);const l=(e,t)=>{h([...t])};return null===(t=n.attachmentsChanged)||void 0===t||t.connect(l),()=>{var e,t,s;null===(e=n.configChanged)||void 0===e||e.disconnect(a),null===(t=n.focusInputSignal)||void 0===t||t.disconnect(i),null===(s=n.attachmentsChanged)||void 0===s||s.disconnect(l)}}),[n]),(0,g.useEffect)((()=>{const e=()=>{v(a.getItems())};return a.itemsChanged.connect(e),e(),()=>{a.itemsChanged.disconnect(e)}}),[a]);const f=!!i.trim();function C(e){if(!["ArrowDown","ArrowUp"].includes(e.key)||l.menu.open){if("Enter"===e.key&&!l.menu.highlighted){if(e.stopPropagation(),!f)return e.stopPropagation(),void e.preventDefault();(r&&e.shiftKey||!r&&!e.shiftKey)&&(n.send(i),e.stopPropagation(),e.preventDefault())}}else e.stopPropagation()}const _=r?p().createElement("span",null,"Press ",p().createElement("b",null,"Shift"),"+",p().createElement("b",null,"Enter")," to send message"):p().createElement("span",null,"Press ",p().createElement("b",null,"Shift"),"+",p().createElement("b",null,"Enter")," to add a new line");return p().createElement(c.Box,{sx:e.sx,className:(0,x.A)(B)},p().createElement(W,{attachments:u,onRemove:n.removeAttachment}),p().createElement(c.Autocomplete,{...l.autocompleteProps,componentsProps:{popper:{placement:"top"},paper:{sx:{border:"1px solid lightgray"}}},ListboxProps:{sx:{"& .MuiAutocomplete-option":{padding:2}}},renderInput:e=>p().createElement(c.TextField,{...e,fullWidth:!0,variant:"outlined",multiline:!0,onKeyDown:C,placeholder:"Start chatting",inputRef:o,sx:{marginTop:"1px"},onSelect:()=>{var e,t;return n.cursorIndex=null!==(t=null===(e=o.current)||void 0===e?void 0:e.selectionStart)&&void 0!==t?t:null},InputProps:{...e.InputProps,endAdornment:p().createElement(c.InputAdornment,{position:"end",className:V},m.map((e=>p().createElement(e.element,{model:n}))))},FormHelperTextProps:{sx:{marginLeft:"auto",marginRight:0}},helperText:i.length>2?_:" "}),inputValue:i,onInputChange:(e,t,a)=>{"reset"!==a&&(n.value=t)}}))}var L=n(7628);const H="jp-chat-tooltipped-wrap";function z(e){var t;return p().createElement(M,{title:e.tooltip,placement:null!==(t=e.placement)&&void 0!==t?t:"top",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[0,-8]}}]}}},p().createElement("span",{className:(0,y.classes)(e.className,H)},p().createElement(c.IconButton,{...e.iconButtonProps,onClick:e.onClick,disabled:e.disabled,sx:{marginLeft:"8px",lineHeight:0,...e.disabled&&{opacity:.5}},"aria-label":e["aria-label"]},e.children)))}var O;!function(e){e[e.None=0]="None",e[e.Copying=1]="Copying",e[e.Copied=2]="Copied",e[e.Disabled=3]="Disabled"}(O||(O={}));const F={[O.None]:"Copy to clipboard",[O.Copying]:"Copyingâ€¦",[O.Copied]:"Copied!",[O.Disabled]:"Copy to clipboard disabled in insecure context"};function $(e){const t=void 0===navigator.clipboard,[n,a]=(0,g.useState)(t?O.Disabled:O.None),i=(0,g.useRef)(null),s=(0,g.useCallback)((async()=>{if(n!==O.Copying){try{await navigator.clipboard.writeText(e.value)}catch(e){return console.error("Failed to copy text: ",e),void a(O.None)}a(O.Copied),i.current&&clearTimeout(i.current),i.current=window.setTimeout((()=>a(O.None)),1e3)}}),[n,e.value]);return p().createElement(z,{disabled:t,className:e.className,tooltip:F[n],placement:"top",onClick:s,"aria-label":"Copy to clipboard"},p().createElement(y.copyIcon.react,{height:"16px",width:"16px"}))}const U=new y.LabIcon({name:"jupyter-chat::chat",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 0 24 24" width="16">\n  <g class="jp-icon3" fill="#616161">\n    <path d="M0 0h24v24H0V0z" fill="none"/>\n    <path d="M15 4v7H5.17L4 12.17V4h11m1-2H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1zm5 4h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1z"/>\n  </g>\n</svg>\n'}),J=new y.LabIcon({name:"jupyter-chat::read",svgstr:'<svg height="24px" viewBox="0 0 24 24" width="24px" xmlns="http://www.w3.org/2000/svg">\n  <g class="jp-icon3">\n    <path\n      style="display:inline;fill:none;fill-opacity:1;stroke:#616161;stroke-width:1.54693;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:1.5;stroke-dasharray:none;stroke-opacity:1;paint-order:normal"\n      d="M 2.2734634,9 V 20.226537 H 21.726536 V 9"\n    />\n    <path\n      style="display:inline;fill:none;stroke:#616161;stroke-width:1.54528;stroke-linecap:square;stroke-miterlimit:10"\n      transform="matrix(0.81805878,0.57513462,-0.81805878,0.57513462,0,0)"\n      d="M 9.5141659,-5.1535239 H 20.802967 V 6.1352773 H 9.5141659 Z"\n    />\n  </g>\n</svg>\n'}),Z=new y.LabIcon({name:"jupyter-ai::replace-cell",svgstr:'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M12 4.71429V7H1.71429V4.71429H12ZM12.5714 3C13.2026 3 13.7143 3.51168 13.7143 4.14286V7.57143C13.7143 8.20263 13.2026 8.71429 12.5714 8.71429H1.14286C0.51168 8.71429 0 8.20263 0 7.57143V4.14286C0 3.51168 0.511669 3 1.14286 3H12.5714Z"\n    fill="#616161"\n    class="jp-icon3"\n  />\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M14 8.71429V11H3.71429V8.71429H14ZM14.5714 7C15.2026 7 15.7143 7.51168 15.7143 8.14286V11.5714C15.7143 12.2026 15.2026 12.7143 14.5714 12.7143H3.14286C2.51168 12.7143 2 12.2026 2 11.5714V8.14286C2 7.51168 2.51167 7 3.14286 7H14.5714Z"\n    fill="#616161"\n    class="jp-icon3"\n  />\n</svg>\n'}),G=new y.LabIcon({name:"jupyter-chat::include",svgstr:'<svg width="18" height="9" viewBox="0 0 18 9" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path fill-rule="evenodd" clip-rule="evenodd"\n        d="M-0.0018417 1.33824L0.837379 0.499023L1.35717 1.01871C1.35741 1.01862 1.35764 1.01853 1.35787 1.01845L3.411 3.07158H3.41049L4.83909 4.49987L3.41011 5.92872H3.41075L1.35769 7.98178C1.35749 7.98171 1.35729 7.98164 1.35709 7.98156L0.837023 8.50158L-0.00219727 7.66236L3.1547 4.49987L-0.0018417 1.33824ZM2.6821 8.07158H16.143C16.932 8.07158 17.5716 7.43201 17.5716 6.64301V2.35729C17.5716 1.56832 16.932 0.928721 16.143 0.928721H2.68236L4.82522 3.07158H15.4287V5.92872H4.82496L2.6821 8.07158ZM1.74238 4.50002L0.428719 5.81655V3.18349L1.74238 4.50002Z"\n        fill="#616161"\n        class="jp-icon3"\n    />\n</svg>\n'}),K="jp-chat-code-toolbar",Y="jp-chat-code-toolbar-item";function q(e){var t;const{content:n,model:a}=e,[i,s]=(0,g.useState)(null===(t=a.config.enableCodeToolbar)||void 0===t||t),o=a.activeCellManager,l=a.selectionWatcher,[r,d]=(0,g.useState)({content:n,activeCellManager:o,selectionWatcher:l,activeCellAvailable:!!(null==o?void 0:o.available),selectionExists:!!(null==l?void 0:l.selection)});return(0,g.useEffect)((()=>{const e=()=>{var e;s(null===(e=a.config.enableCodeToolbar)||void 0===e||e)},t=()=>{d({content:n,activeCellManager:o,selectionWatcher:l,activeCellAvailable:!!(null==o?void 0:o.available),selectionExists:!!(null==l?void 0:l.selection)})};return null==o||o.availabilityChanged.connect(t),null==l||l.selectionChanged.connect(t),a.configChanged.connect(e),t(),()=>{null==o||o.availabilityChanged.disconnect(t),null==l||l.selectionChanged.disconnect(t),a.configChanged.disconnect(e)}}),[a]),null!==o&&i?p().createElement(c.Box,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",padding:"2px 2px",marginBottom:"1em",border:"1px solid var(--jp-cell-editor-border-color)",borderTop:"none"},className:K},p().createElement(Q,{...r,className:Y}),p().createElement(X,{...r,className:Y}),p().createElement(ee,{...r,className:Y}),p().createElement($,{value:n,className:Y})):p().createElement(p().Fragment,null)}function Q(e){const t=e.activeCellAvailable?"Insert above active cell":"Insert above active cell (no active cell)";return p().createElement(z,{className:e.className,tooltip:t,onClick:()=>{var t;return null===(t=e.activeCellManager)||void 0===t?void 0:t.insertAbove(e.content)},disabled:!e.activeCellAvailable},p().createElement(y.addAboveIcon.react,{height:"16px",width:"16px"}))}function X(e){const t=e.activeCellAvailable?"Insert below active cell":"Insert below active cell (no active cell)";return p().createElement(z,{className:e.className,tooltip:t,disabled:!e.activeCellAvailable,onClick:()=>{var t;return null===(t=e.activeCellManager)||void 0===t?void 0:t.insertBelow(e.content)}},p().createElement(y.addBelowIcon.react,{height:"16px",width:"16px"}))}function ee(e){var t,n;const a=e.selectionExists?`Replace selection (${null===(n=null===(t=e.selectionWatcher)||void 0===t?void 0:t.selection)||void 0===n?void 0:n.numLines} line(s))`:e.activeCellAvailable?"Replace selection (active cell)":"Replace selection (no selection)",i=!e.activeCellAvailable&&!e.selectionExists;return p().createElement(z,{className:e.className,tooltip:a,disabled:i,onClick:()=>{var t,n,a;if(e.selectionExists){const a=null===(t=e.selectionWatcher)||void 0===t?void 0:t.selection;if(!a)return;null===(n=e.selectionWatcher)||void 0===n||n.replaceSelection({...a,text:e.content})}else e.activeCellAvailable&&(null===(a=e.activeCellManager)||void 0===a||a.replace(e.content))}},p().createElement(Z.react,{height:"16px",width:"16px"}))}const te="jp-chat-toolbar";function ne(e){const t=[];if(void 0!==e.edit){const n=(0,y.ToolbarButtonComponent)({icon:y.editIcon,onClick:e.edit,tooltip:"Edit"});t.push(n)}if(void 0!==e.delete){const n=(0,y.ToolbarButtonComponent)({icon:y.deleteIcon,onClick:e.delete,tooltip:"Delete"});t.push(n)}return p().createElement("div",{className:te},t.map((e=>e)))}const ae="text/markdown",ie=p().memo((function(e){const t=e.appendContent||!1,[n,a]=(0,g.useState)(null),[i,s]=(0,g.useState)([]);return(0,g.useEffect)((()=>{(async()=>{var t,n;const i=e.markdownStr.replace(/\\\(/g,"\\\\(").replace(/\\\)/g,"\\\\)").replace(/\\\[/g,"\\\\[").replace(/\\\]/g,"\\\\]"),o=e.rmRegistry.createModel({data:{[ae]:i}}),l=e.rmRegistry.createRenderer(ae);if(await l.renderModel(o),null===(t=e.rmRegistry.latexTypesetter)||void 0===t||t.typeset(l.node),!l.node)throw new Error("Rendermime was unable to render Markdown content within a chat message. Please report this upstream to Jupyter chat on GitHub.");null===(n=e.rmRegistry.latexTypesetter)||void 0===n||n.typeset(l.node);const r=[];l.node.querySelectorAll("pre").forEach((t=>{var n;const a=document.createElement("div");null===(n=t.parentNode)||void 0===n||n.insertBefore(a,t.nextSibling),r.push([a,{model:e.model,content:t.textContent||""}])})),s(r),a(l.node),e.rendered.resolve()})()}),[e.markdownStr,e.rmRegistry]),p().createElement("div",{className:"jp-chat-rendered-markdown"},n&&(t?p().createElement("div",{ref:e=>e&&e.appendChild(n)}):p().createElement("div",{ref:e=>e&&e.replaceChildren(n)})),p().createElement(ne,{edit:e.edit,delete:e.delete}),i.map((e=>{const[t,n]=e;return(0,L.createPortal)(p().createElement(q,{...n}),t)})))}));function se(e){const t=(0,g.useMemo)((()=>"jupyter-chat-scroll-container-"+Date.now().toString()),[]);return p().createElement(c.Box,{id:t,sx:{overflowY:"scroll","& *":{overflowAnchor:"none"},...e.sx}},p().createElement(c.Box,{sx:{minHeight:"100.01%"}},e.children),p().createElement(c.Box,{sx:{overflowAnchor:"auto",height:"1px"}}))}const oe=new Set([" ","\n","\t"]);class le{constructor(e){var t,n,a;this.send=e=>{this._onSend(e,this),this.value=""},this.addAttachment=e=>{this._attachments.find((t=>t.type===e.type&&t.value===e.value))||(this._attachments.push(e),this._attachmentsChanged.emit([...this._attachments]))},this.removeAttachment=e=>{const t=this._attachments.findIndex((t=>t.type===e.type&&t.value===e.value));-1!==t&&(this._attachments.splice(t,1),this._attachmentsChanged.emit([...this._attachments]))},this.clearAttachments=()=>{this._attachments=[],this._attachmentsChanged.emit([])},this._cursorIndex=null,this._currentWord=null,this._valueChanged=new s.Signal(this),this._cursorIndexChanged=new s.Signal(this),this._currentWordChanged=new s.Signal(this),this._configChanged=new s.Signal(this),this._focusInputSignal=new s.Signal(this),this._attachmentsChanged=new s.Signal(this),this._isDisposed=!1,this._onSend=e.onSend,this._value=e.value||"",this._attachments=e.attachments||[],this.cursorIndex=e.cursorIndex||this.value.length,this._activeCellManager=null!==(t=e.activeCellManager)&&void 0!==t?t:null,this._selectionWatcher=null!==(n=e.selectionWatcher)&&void 0!==n?n:null,this._documentManager=null!==(a=e.documentManager)&&void 0!==a?a:null,this._config={...e.config},this.cancel=e.onCancel}get value(){return this._value}set value(e){this._value=e,this._valueChanged.emit(e)}get valueChanged(){return this._valueChanged}get cursorIndex(){return this._cursorIndex}set cursorIndex(e){if(null===e||e>this._value.length)return;if(this._cursorIndex=e,this._cursorIndexChanged.emit(e),null===this._cursorIndex)return;const t=re.getCurrentWord(this._value,this._cursorIndex);t!==this._currentWord&&(this._currentWord=t,this._currentWordChanged.emit(this._currentWord))}get cursorIndexChanged(){return this._cursorIndexChanged}get currentWord(){return this._currentWord}get currentWordChanged(){return this._currentWordChanged}get activeCellManager(){return this._activeCellManager}get selectionWatcher(){return this._selectionWatcher}get documentManager(){return this._documentManager}get config(){return this._config}set config(e){this._config={...this._config,...e},this._configChanged.emit(this._config)}get configChanged(){return this._configChanged}focus(){this._focusInputSignal.emit()}get focusInputSignal(){return this._focusInputSignal}get attachments(){return this._attachments}get attachmentsChanged(){return this._attachmentsChanged}replaceCurrentWord(e){if(null===this.cursorIndex)return;const[t,n]=re.getCurrentWordBoundaries(this.value,this.cursorIndex);this.value=this.value.slice(0,t)+e+this.value.slice(n)}dispose(){this.isDisposed||(this._isDisposed=!0)}get isDisposed(){return this._isDisposed}}var re;!function(e){function t(e,t){let n=t,a=t;const i=e.length;for(;n>0&&!oe.has(e[n-1]);)n--;for(;a<i&&!oe.has(e[a]);)a++;return[n,a]}e.getCurrentWordBoundaries=t,e.getCurrentWord=function(e,n){const[a,i]=t(e,n);return e.slice(a,i)}}(re||(re={}));const ce="jp-chat-messages-container",de="jp-chat-message",ue="jp-chat-message-stacked",he="jp-chat-message-header",me="jp-chat-message-time",ge="jp-chat-writers",pe="jp-chat-navigation",ve="jp-chat-navigation-unread",fe="jp-chat-navigation-top",Ce="jp-chat-navigation-bottom";function _e(e){const{model:t}=e,[n,a]=(0,g.useState)(t.messages),i=(0,g.useRef)(null),[s,o]=(0,g.useState)([]),[l,r]=(0,g.useState)(!1),d=(0,g.useRef)([]),u=(0,g.useRef)([]);return(0,g.useEffect)((()=>{!async function(){t.getHistory&&t.getHistory().then((e=>a(e.messages))).catch((e=>console.error(e)))}(),o([])}),[t]),(0,g.useEffect)((()=>{var e;function n(){a([...t.messages])}return t.messagesUpdated.connect(n),null===(e=t.writersChanged)||void 0===e||e.connect((function(e,t){o(t)})),function(){var e;t.messagesUpdated.disconnect(n),null===(e=t.writersChanged)||void 0===e||e.disconnect(n)}}),[t]),(0,g.useEffect)((()=>{const n=new IntersectionObserver((n=>{var a;l||Promise.all(u.current.map((e=>e.promise))).then((()=>{r(!0)}));const i=[...t.unreadMessages];let s=!1;const o=[...null!==(a=t.messagesInViewport)&&void 0!==a?a:[]];n.forEach((e=>{var t;const n=parseInt(null!==(t=e.target.getAttribute("data-index"))&&void 0!==t?t:"");if(!isNaN(n)){const t=o.indexOf(n);if(e.isIntersecting||-1===t?e.isIntersecting&&-1===t&&o.push(n):o.splice(t,1),i.length){const t=i.indexOf(n);-1!==t&&e.isIntersecting&&(i.splice(t,1),s=!0)}}})),e.model.messagesInViewport=o,l&&s&&(t.unreadMessages=i)}));return d.current.forEach((e=>{e&&n.observe(e)})),()=>{d.current.forEach((e=>{e&&n.unobserve(e)}))}}),[n,l]),p().createElement(p().Fragment,null,p().createElement(se,{sx:{flexGrow:1}},p().createElement(c.Box,{ref:i,className:(0,x.A)(ce)},n.map(((t,n)=>(u.current[n]=new E.PromiseDelegate,p().createElement(c.Box,{key:n,className:(0,x.A)(de,t.stacked?ue:"")},p().createElement(be,{message:t}),p().createElement(ye,{...e,message:t,index:n,renderedPromise:u.current[n],ref:e=>d.current[n]=e})))))),p().createElement(Ee,{writers:s})),p().createElement(xe,{...e,refMsgBox:i,allRendered:l}))}function be(e){var t,n;const[a,i]=(0,g.useState)({}),s=e.message,o=s.sender;(0,g.useEffect)((()=>{if(!a[s.time]){const e={};let t;const n=new Date,a=e=>e.getFullYear()===n.getFullYear()&&e.getMonth()===n.getMonth()&&e.getDate()===n.getDate(),o=new Date(1e3*s.time);t=a(o)?o.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}):o.toLocaleString([],{day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"}),e[s.time]=t,i(e)}}));const l=s.stacked?null:we({user:o}),r=null!==(n=null!==(t=o.display_name)&&void 0!==t?t:o.name)&&void 0!==n?n:o.username||"User undefined";return p().createElement(c.Box,{className:he,sx:{display:"flex",alignItems:"center","& > :not(:last-child)":{marginRight:3},marginBottom:s.stacked?"0px":"12px"}},l,p().createElement(c.Box,{sx:{display:"flex",flexGrow:1,flexWrap:"wrap",justifyContent:"space-between",alignItems:"center"}},p().createElement(c.Box,{sx:{display:"flex",alignItems:"center"}},!s.stacked&&p().createElement(c.Typography,{sx:{fontWeight:700,color:"var(--jp-ui-font-color1)",paddingRight:"0.5em"}},r),(s.deleted||s.edited)&&p().createElement(c.Typography,{sx:{fontStyle:"italic",fontSize:"var(--jp-content-font-size0)"}},s.deleted?"(message deleted)":"(edited)")),p().createElement(c.Typography,{className:me,sx:{fontSize:"0.8em",color:"var(--jp-ui-font-color2)",fontWeight:300},title:s.raw_time?"Unverified time":""},`${a[s.time]}${s.raw_time?"*":""}`)))}const ye=(0,g.forwardRef)(((e,t)=>{const{message:n,model:a,rmRegistry:i}=e,[s,o]=(0,g.useState)(!1),[l,r]=(0,g.useState)(!1),[c,d]=(0,g.useState)(!1),[u,h]=(0,g.useState)(!1),[m,v]=(0,g.useState)(null);(0,g.useEffect)((()=>{var e;r(null!==(e=n.deleted)&&void 0!==e&&e),void 0===a.user||n.deleted?(d(!1),h(!1)):a.user.username===n.sender.username&&(d(void 0!==a.updateMessage),h(void 0!==a.deleteMessage))}),[a,n]),(0,g.useEffect)((()=>{v(s&&c?new le({onSend:(e,t)=>C(n.id,e,t),onCancel:()=>f(),value:n.body,config:{sendWithShiftEnter:a.config.sendWithShiftEnter},attachments:n.attachments,documentManager:a.documentManager}):null)}),[s]);const f=()=>{o(!1)},C=(e,t,i)=>{if(!c||!i)return;const s={...n};s.body=t,s.attachments=i.attachments,a.updateMessage(e,s),o(!1)};return l?p().createElement("div",{ref:t,"data-index":e.index}):p().createElement("div",{ref:t,"data-index":e.index},s&&c&&m?p().createElement(D,{onCancel:()=>f(),model:m,chatCommandRegistry:e.chatCommandRegistry,toolbarRegistry:e.inputToolbarRegistry}):p().createElement(ie,{rmRegistry:i,markdownStr:n.body,model:a,edit:c?()=>o(!0):void 0,delete:u?()=>{return e=n.id,void(u&&a.deleteMessage(e));var e}:void 0,rendered:e.renderedPromise}),n.attachments&&!s&&p().createElement(W,{attachments:n.attachments}))}));function Ee(e){const{writers:t}=e;return t.length>0?p().createElement(c.Box,{className:ge},t.map(((e,n)=>{var a,i;return p().createElement("div",null,p().createElement(we,{user:e,small:!0}),p().createElement("span",null,null!==(i=null!==(a=e.display_name)&&void 0!==a?a:e.name)&&void 0!==i?i:e.username||"User undefined"),p().createElement("span",null,n<t.length-1?n<t.length-2?", ":" and ":""))})),p().createElement("span",null,(t.length>1?" are":" is")+" writing")):null}function xe(e){const{model:t}=e,[n,a]=(0,g.useState)(!0),[i,s]=(0,g.useState)(null),[o,l]=(0,g.useState)(null),r=(t,n=!0)=>{var a,i;null===(i=null===(a=e.refMsgBox.current)||void 0===a?void 0:a.children.item(t))||void 0===i||i.scrollIntoView(n)};return(0,g.useEffect)((()=>{var n;if(!e.allRendered)return;const a=(e,t)=>{const n=e.messagesInViewport;if(!n)return;let a=null!==i&&t.includes(i)&&i<Math.min(...n)?i:null,r=null!==o&&t.includes(o)&&o>Math.max(...n)?o:null;t.forEach((t=>{(null==n?void 0:n.includes(t))||(t<(null!=a?a:Math.min(...n))?a=t:t>Math.max(...n)&&t<(null!=r?r:e.messages.length)&&(r=t))})),s(a),l(r)};return null===(n=t.unreadChanged)||void 0===n||n.connect(a),a(t,t.unreadMessages),r(t.messages.length-1,!1),()=>{var e;null===(e=t.unreadChanged)||void 0===e||e.disconnect(a)}}),[t,e.allRendered]),(0,g.useEffect)((()=>{var e,n;const i=(e,t)=>{a(t.includes(e.messages.length-1))};return null===(e=t.viewportChanged)||void 0===e||e.connect(i),i(t,null!==(n=t.messagesInViewport)&&void 0!==n?n:[]),()=>{var e;null===(e=t.viewportChanged)||void 0===e||e.disconnect(i)}}),[t]),p().createElement(p().Fragment,null,null!==i&&p().createElement(b.Button,{className:`${pe} ${ve} ${fe}`,onClick:()=>r(i),title:"Go to unread messages"},p().createElement(y.LabIcon.resolveReact,{display:"flex",icon:y.caretDownEmptyIcon,iconClass:(0,y.classes)("jp-Icon")})),(null!==o||!n)&&p().createElement(b.Button,{className:`${pe} ${null!==o?ve:""} ${Ce}`,onClick:null===o?()=>r(t.messages.length-1,!1):()=>r(o),title:null!==o?"Go to unread messages":"Go to last message"},p().createElement(y.LabIcon.resolveReact,{display:"flex",icon:y.caretDownEmptyIcon,iconClass:(0,y.classes)("jp-Icon")})))}function we(e){var t,n;const{user:a}=e,i={height:(e.small?"16":"24")+"px",width:(e.small?"16":"24")+"px",bgcolor:a.color,fontSize:`var(--jp-ui-font-size${e.small?"0":"1"})`},s=null!==(n=null!==(t=a.display_name)&&void 0!==t?t:a.name)&&void 0!==n?n:a.username||"User undefined";return a.avatar_url?p().createElement(c.Avatar,{sx:{...i},src:a.avatar_url,alt:s,title:s}):a.initials?p().createElement(c.Avatar,{sx:{...i},alt:s,title:s},p().createElement(c.Typography,{sx:{fontSize:`var(--jp-ui-font-size${e.small?"0":"1"})`,color:"var(--jp-ui-inverse-font-color1)"}},a.initials)):null}var Me=n(9483),Ae=n(40443);const Se="jp-chat-send-button",Ie="jp-chat-send-include-opener",ke="jp-chat-send-include";function je(e){const{model:t}=e,{activeCellManager:n,selectionWatcher:a}=t,i=!n||!a,[s,o]=(0,g.useState)(null),[l,r]=(0,g.useState)(!1),[d,u]=(0,g.useState)(!1),[h,m]=(0,g.useState)(""),v=(0,g.useCallback)((e=>{o(e),r(!0)}),[]),f=(0,g.useCallback)((()=>{r(!1)}),[]),[C,_]=(0,g.useState)(""),[b,y]=(0,g.useState)(!0);return(0,g.useEffect)((()=>{var e;const n=()=>{const e=!!t.value.trim()||t.attachments.length;u(!e)};t.valueChanged.connect(n),null===(e=t.attachmentsChanged)||void 0===e||e.connect(n),n();const a=(e,t)=>{var n;m(null!==(n=t.sendWithShiftEnter)&&void 0!==n&&n?"Send message (SHIFT+ENTER)":"Send message (ENTER)")};return t.configChanged.connect(a),()=>{var e,i;t.valueChanged.disconnect(n),null===(e=t.attachmentsChanged)||void 0===e||e.disconnect(n),null===(i=t.configChanged)||void 0===i||i.disconnect(a)}}),[t]),(0,g.useEffect)((()=>{const e=()=>{y(!((null==a?void 0:a.selection)||(null==n?void 0:n.available)));const e=(null==a?void 0:a.selection)?`${a.selection.numLines} line(s) selected`:(null==n?void 0:n.available)?"Code from 1 active cell":"No selection or active cell";_(e)};return i||(null==a||a.selectionChanged.connect(e),null==n||n.availabilityChanged.connect(e),e()),()=>{null==a||a.selectionChanged.disconnect(e),null==n||n.availabilityChanged.disconnect(e)}}),[n,a]),p().createElement(p().Fragment,null,p().createElement(S,{onClick:()=>t.send(t.value),disabled:d,tooltip:h,buttonProps:{size:"small",title:h,variant:"contained",className:Se}},p().createElement(Ae.A,null)),!i&&p().createElement(p().Fragment,null,p().createElement(S,{onClick:e=>{v(e.currentTarget)},disabled:d,tooltip:"",buttonProps:{variant:"contained",onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(v(e.currentTarget),e.stopPropagation())},className:Ie}},p().createElement(Me.A,null)),p().createElement(c.Menu,{open:l,onClose:f,anchorEl:s,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},sx:{"& .MuiMenuItem-root":{display:"flex",alignItems:"center",gap:"8px"},"& svg":{lineHeight:0}}},p().createElement(c.MenuItem,{onClick:e=>{!function(){let e="";(null==a?void 0:a.selection)?e=a.selection.text:(null==n?void 0:n.available)&&(e=n.getContent(!1).source);let i=t.value;e&&(i+=`\n\n\`\`\`\n${e}\n\`\`\`\n`),t.send(i),f(),t.value=""}(),e.stopPropagation()},disabled:b,className:ke},p().createElement(G.react,null),p().createElement(c.Box,null,p().createElement(c.Typography,{display:"block"},"Send message with selection"),p().createElement(c.Typography,{display:"block",sx:{opacity:.618}},C))))))}var Ne=n(50498),Re=n(40530);const We="jp-chat-attach-button";function Te(e){const{model:t}=e,n="Add attachment";return t.documentManager&&t.addAttachment?p().createElement(S,{onClick:async()=>{if(t.documentManager&&t.addAttachment)try{const e=await Ne.FileDialog.getOpenFiles({title:"Select files to attach",manager:t.documentManager});e.value&&e.value.forEach((e=>{var n;"directory"!==e.type&&(null===(n=t.addAttachment)||void 0===n||n.call(t,{type:"file",value:e.path}))}))}catch(e){console.warn("Error selecting files to attach",e)}},tooltip:n,buttonProps:{size:"small",variant:"contained",title:n,className:We}},p().createElement(Re.A,null)):p().createElement(p().Fragment,null)}var Pe=n(82299);const Be="jp-chat-cancel-button";function Ve(e){if(!e.model.cancel)return p().createElement(p().Fragment,null);const t="Cancel edition";return p().createElement(S,{onClick:e.model.cancel,tooltip:t,buttonProps:{size:"small",variant:"contained",title:t,className:Be}},p().createElement(Pe.A,null))}class De{constructor(){this._items=new Map,this._itemsChanged=new s.Signal(this)}get itemsChanged(){return this._itemsChanged}get(e){return this._items.get(e)}getItems(){return Array.from(this._items.values()).filter((e=>!e.hidden)).sort(((e,t)=>e.position-t.position))}addItem(e,t){this._items.has(e)?console.warn(`A chat input toolbar item '${e}' is already registered`):(this._items.set(e,t),this._itemsChanged.emit())}hide(e){const t=this._items.get(e);t&&(t.hidden=!0,this._itemsChanged.emit())}show(e){const t=this._items.get(e);t&&(t.hidden=!1,this._itemsChanged.emit())}}function Le(e){const{model:t}=e;let{inputToolbarRegistry:n}=e;return n||(n=De.defaultToolbarRegistry()),p().createElement(I.Provider,{value:e.attachmentOpenerRegistry},p().createElement(_e,{rmRegistry:e.rmRegistry,model:t,chatCommandRegistry:e.chatCommandRegistry,inputToolbarRegistry:n}),p().createElement(D,{sx:{paddingLeft:4,paddingRight:4,paddingTop:1,paddingBottom:0,borderTop:"1px solid var(--jp-border-color1)"},model:t.input,chatCommandRegistry:e.chatCommandRegistry,toolbarRegistry:n}))}function He(e){var t;const[n,a]=(0,g.useState)(e.chatView||He.View.chat);return p().createElement(_,{themeManager:null!==(t=e.themeManager)&&void 0!==t?t:null},p().createElement(m,{className:"jp-ThemedContainer",sx:{width:"100%",height:"100%",boxSizing:"border-box",background:"var(--jp-layout-color0)",display:"flex",flexDirection:"column"}},p().createElement(m,{sx:{display:"flex",justifyContent:"space-between"}},n!==He.View.chat?p().createElement(c.IconButton,{onClick:()=>a(He.View.chat)},p().createElement(l.A,null)):p().createElement(m,null),n!==He.View.settings&&e.settingsPanel?p().createElement(c.IconButton,{onClick:()=>a(He.View.settings)},p().createElement(r.A,null)):p().createElement(m,null)),n===He.View.chat&&p().createElement(Le,{...e}),n===He.View.settings&&e.settingsPanel&&p().createElement(e.settingsPanel,null)))}!function(e){e.defaultToolbarRegistry=function(){const t=new e;return t.addItem("send",{element:je,position:100}),t.addItem("attach",{element:Te,position:20}),t.addItem("cancel",{element:Ve,position:10}),t}}(De||(De={})),function(e){let t;!function(e){e[e.chat=0]="chat",e[e.settings=1]="settings"}(t=e.View||(e.View={}))}(He||(He={}));class ze{constructor(e={}){var t,n,a,i;this._messages=[],this._unreadMessages=[],this._messagesInViewport=[],this._name="",this._isDisposed=!1,this._notificationId=null,this._messagesUpdated=new s.Signal(this),this._configChanged=new s.Signal(this),this._unreadChanged=new s.Signal(this),this._viewportChanged=new s.Signal(this),this._writersChanged=new s.Signal(this),e.id&&(this.id=e.id);const o=null!==(t=e.config)&&void 0!==t?t:{};this._config={stackMessages:!0,sendTypingNotification:!0,...o},this._inputModel=new le({activeCellManager:e.activeCellManager,selectionWatcher:e.selectionWatcher,documentManager:e.documentManager,config:{sendWithShiftEnter:o.sendWithShiftEnter},onSend:e=>this.sendMessage({body:e})}),this._commands=e.commands,this._activeCellManager=null!==(n=e.activeCellManager)&&void 0!==n?n:null,this._selectionWatcher=null!==(a=e.selectionWatcher)&&void 0!==a?a:null,this._documentManager=null!==(i=e.documentManager)&&void 0!==i?i:null}get id(){return this._id}set id(e){this._id=e}get name(){return this._name}set name(e){this._name=e}get messages(){return this._messages}get input(){return this._inputModel}get activeCellManager(){return this._activeCellManager}get selectionWatcher(){return this._selectionWatcher}get documentManager(){return this._documentManager}get lastRead(){var e;return void 0===this._id?0:null!==(e=JSON.parse(localStorage.getItem(`@jupyter/chat:${this._id}`)||"{}").lastRead)&&void 0!==e?e:0}set lastRead(e){if(void 0===this._id)return;const t=JSON.parse(localStorage.getItem(`@jupyter/chat:${this._id}`)||"{}");t.lastRead=e,localStorage.setItem(`@jupyter/chat:${this._id}`,JSON.stringify(t))}get config(){return this._config}set config(e){const t="stackMessages"in e&&this._config.stackMessages!==e.stackMessages,n="unreadNotifications"in e&&this._config.unreadNotifications!==e.unreadNotifications;this._config={...this._config,...e},this._configChanged.emit(this._config),this.input.config=e,t&&(this._config.stackMessages?this._messages.slice(1).forEach(((e,t)=>{const n=this._messages[t].sender.username;e.stacked=n===e.sender.username})):this._messages.forEach((e=>{delete e.stacked})),this._messagesUpdated.emit()),n&&!this._config.unreadNotifications&&this._notify(0)}get unreadMessages(){return this._unreadMessages}set unreadMessages(e){var t;const n=this._unreadMessages.filter((t=>!e.includes(t))),a=e.length-this._unreadMessages.length;if(this._unreadMessages=e,this._unreadChanged.emit(this._unreadMessages),this._notify(e.length,a>0),void 0!==this._id&&n.length){let e=!1,a=null!==(t=this.lastRead)&&void 0!==t?t:this.messages[n[0]].time;n.forEach((t=>{this.messages[t].time>a&&(a=this.messages[t].time,e=!0)})),e&&(this.lastRead=a)}}get messagesInViewport(){return this._messagesInViewport}set messagesInViewport(e){this._messagesInViewport=e,this._viewportChanged.emit(e)}get messagesUpdated(){return this._messagesUpdated}get configChanged(){return this._configChanged}get unreadChanged(){return this._unreadChanged}get viewportChanged(){return this._viewportChanged}get writersChanged(){return this._writersChanged}sendMessage(e){}clearMessages(){this._messages=[],this._messagesUpdated.emit()}dispose(){this.isDisposed||(this._isDisposed=!0)}get isDisposed(){return this._isDisposed}formatChatMessage(e){return e}messageAdded(e){const t=this._messages.findIndex((t=>t.id===e.id));t>-1&&this._messages.splice(t,1);let n=this._messages.findIndex((t=>t.time>e.time));-1===n&&(n=this._messages.length),this.messagesInserted(n,[e])}messagesInserted(e,t){var n;const a=[],i=[],s=null!==(n=this.lastRead)&&void 0!==n?n:0;if(t.forEach(((t,n)=>{a.push(this.formatChatMessage(t)),t.time>s&&i.push(e+n)})),this._messages.splice(e,0,...a),this._config.stackMessages){const t=e+a.length-1,n=0===e?1:e,i=this._messages.length>t+1?t+1:t;for(let e=n;e<=i;e++){const t=this._messages[e],n=this._messages[e-1].sender.username;t.stacked=n===t.sender.username}}this._addUnreadMessages(i),this._messagesUpdated.emit()}messagesDeleted(e,t){this._messages.splice(e,t),this._messagesUpdated.emit()}updateWriters(e){this._writersChanged.emit(e)}_addUnreadMessages(e){const t=new Set(this._unreadMessages);e.forEach((e=>t.add(e))),this.unreadMessages=Array.from(t.values())}_notify(e,t=!1){this._commands&&(e&&this._config.unreadNotifications?this._commands.execute("apputils:update-notification",{id:this._notificationId,message:`${e} incoming message(s) ${this._name?"in "+this._name:""}`}).then((n=>{!n&&t&&this._commands.execute("apputils:notify",{type:"info",message:`${e} incoming message(s) in ${this._name}`}).then((e=>{this._notificationId=e}))})):this._notificationId&&(this._commands.execute("apputils:dismiss-notification",{id:this._notificationId}),this._notificationId=null))}}const Oe=new E.Token("@jupyter/chat:IAttachmentOpenerRegistry");class Fe extends Map{}var $e=n(87178),Ue=n(64053),Je=n(18178),Ze=n(54461);function Ge(e){var t;if(!(e instanceof $e.DocumentWidget))return null;let n;const{content:a}=e;return a instanceof Ze.FileEditor?n=a.editor:a instanceof i.Notebook&&(n=null===(t=a.activeCell)||void 0===t?void 0:t.editor),n instanceof Je.CodeMirrorEditor?n:void 0}class Ke{constructor(e){var t;this._mainAreaDocumentWidget=null,this._selection=null,this._selectionChanged=new s.Signal(this),this._shell=e.shell,null===(t=this._shell.currentChanged)||void 0===t||t.connect(((e,t)=>{var n;const a=t.newValue;if(null===a)return void(this._mainAreaDocumentWidget=null);const s=Ge(a);a instanceof $e.DocumentWidget&&(s||a.content instanceof i.Notebook)?this._mainAreaDocumentWidget=a:(null===(n=this._mainAreaDocumentWidget)||void 0===n?void 0:n.isDisposed)&&(this._mainAreaDocumentWidget=null)})),setInterval(this._poll.bind(this),200)}get selection(){return this._selection}get selectionChanged(){return this._selectionChanged}replaceSelection(e){const t=(0,Ue.find)(this._shell.widgets(),(t=>t.id===e.widgetId));if(!((null==t?void 0:t.isVisible)&&t instanceof $e.DocumentWidget))return;if(this._shell.activateById(e.widgetId),t.content instanceof i.Notebook&&e.cellId){const n=function(e,t){var n;const a=null===(n=e.model)||void 0===n?void 0:n.sharedModel.cells.findIndex((e=>e.getId()===t));return void 0===a?-1:a}(t.content,e.cellId);-1!==n&&(t.content.activeCellIndex=n)}const n=Ge(t);if(!n)return;n.model.sharedModel.updateSource(n.getOffsetAt(e.start),n.getOffsetAt(e.end),e.text);const a=n.getPositionAt(n.getOffsetAt(e.start)+e.text.length);n.setSelection({start:a,end:a})}_poll(){var e;let t=null;const n=this._selection;(null===(e=this._mainAreaDocumentWidget)||void 0===e?void 0:e.isVisible)&&(t=function(e){var t;const n=Ge(e);if(!(n&&e instanceof $e.DocumentWidget))return null;let a;e.content instanceof i.Notebook&&(a=null===(t=e.content.activeCell)||void 0===t?void 0:t.model.id);const s=n.getSelection();let{start:o,end:l}=s;const r=n.getOffsetAt(o),c=n.getOffsetAt(l),d=n.model.sharedModel.getSource().substring(r,c);return d?(r>c&&([o,l]=[l,o]),{...s,start:o,end:l,text:d,numLines:d.split("\n").length,widgetId:e.id,...a&&{cellId:a}}):null}(this._mainAreaDocumentWidget)),(null==n?void 0:n.text)!==(null==t?void 0:t.text)&&(this._selection=t,this._selectionChanged.emit(t))}}var Ye=n(45551);function qe(e){const t=Ye.ReactWidget.create(p().createElement(_,{themeManager:e},p().createElement(c.Box,{sx:{width:"100%",height:"100%",boxSizing:"border-box",background:"var(--jp-layout-color0)",display:"flex",flexDirection:"column"}},p().createElement(c.Box,{sx:{padding:4}},p().createElement(c.Alert,{severity:"error"},"There seems to be a problem with the Chat backend, please look at the JupyterLab server logs or contact your administrator to correct this problem.")))));return t.id="jupyter-chat::chat",t.title.icon=U,t.title.caption="Jupyter Chat",t}function Qe(e){const t=Ye.ReactWidget.create(p().createElement(He,{...e}));return t.id="jupyter-chat::side-panel",t.title.icon=U,t.title.caption="Jupyter Chat",t}class Xe extends Ye.ReactWidget{constructor(e){super(),this.title.icon=U,this.title.caption="Jupyter Chat",this._chatOptions=e,this.id=`jupyter-chat::widget::${e.model.name}`,this.node.onclick=()=>this.model.input.focus()}get model(){return this._chatOptions.model}get inputToolbarRegistry(){return this._chatOptions.inputToolbarRegistry}render(){return p().createElement(He,{...this._chatOptions,model:this._chatOptions.model})}}class et{constructor(){this._providers=new Map}addProvider(e){this._providers.set(e.id,e)}getProviders(){return Array.from(this._providers.values())}handleChatCommand(e,t){const n=this._providers.get(e.providerId);n?n.handleChatCommand(e,t):console.error("Error in handling chat command: No command provider has an ID of "+e.providerId)}}const tt=new E.Token("@jupyter/chat:IChatCommandRegistry")},92659:(e,t,n)=>{var a=n(95709);t.A=void 0;var i=a(n(42032)),s=n(74848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack")},40530:(e,t,n)=>{var a=n(95709);t.A=void 0;var i=a(n(42032)),s=n(74848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z"}),"AttachFile")},82299:(e,t,n)=>{var a=n(95709);t.A=void 0;var i=a(n(42032)),s=n(74848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel")},39781:(e,t,n)=>{var a=n(95709);t.A=void 0;var i=a(n(42032)),s=n(74848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close")},9483:(e,t,n)=>{var a=n(95709);t.A=void 0;var i=a(n(42032)),s=n(74848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"}),"KeyboardArrowDown")},40443:(e,t,n)=>{var a=n(95709);t.A=void 0;var i=a(n(42032)),s=n(74848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send")},20448:(e,t,n)=>{var a=n(95709);t.A=void 0;var i=a(n(42032)),s=n(74848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings")},72363:(e,t,n)=>{n.d(t,{A:()=>c});var a=n(55285),i=n(40644),s=(n(93345),n(41145)),o=n(58312),l=n(74848);const r=["theme"];function c(e){let{theme:t}=e,n=(0,i.A)(e,r);const c=t[o.A];return(0,l.jsx)(s.A,(0,a.A)({},n,{themeId:c?o.A:void 0,theme:c||t}))}},83738:(e,t,n)=>{n.d(t,{A:()=>a});const a=n(93345).createContext(null)},84022:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(93345),i=n(83738);function s(){return a.useContext(i.A)}},73788:(e,t,n)=>{n.d(t,{A:()=>d,I:()=>c});var a=n(55285),i=n(40644),s=n(93345),o=n(74848);const l=["value"],r=s.createContext(),c=()=>{const e=s.useContext(r);return null!=e&&e},d=function(e){let{value:t}=e,n=(0,i.A)(e,l);return(0,o.jsx)(r.Provider,(0,a.A)({value:null==t||t},n))}},41145:(e,t,n)=>{n.d(t,{A:()=>p});var a=n(55285),i=n(93345),s=n(84022),o=n(83738);const l="function"==typeof Symbol&&Symbol.for?Symbol.for("mui.nested"):"__THEME_NESTED__";var r=n(74848);const c=function(e){const{children:t,theme:n}=e,c=(0,s.A)(),d=i.useMemo((()=>{const e=null===c?n:function(e,t){return"function"==typeof t?t(e):(0,a.A)({},e,t)}(c,n);return null!=e&&(e[l]=null!==c),e}),[n,c]);return(0,r.jsx)(o.A.Provider,{value:d,children:t})};var d=n(40085),u=n(53951),h=n(73788);const m={};function g(e,t,n,s=!1){return i.useMemo((()=>{const i=e&&t[e]||t;if("function"==typeof n){const o=n(i),l=e?(0,a.A)({},t,{[e]:o}):o;return s?()=>l:l}return e?(0,a.A)({},t,{[e]:n}):(0,a.A)({},t,n)}),[e,t,n,s])}const p=function(e){const{children:t,theme:n,themeId:a}=e,i=(0,u.A)(m),o=(0,s.A)()||m,l=g(a,i,n),p=g(a,o,n,!0),v="rtl"===l.direction;return(0,r.jsx)(c,{theme:p,children:(0,r.jsx)(d.T.Provider,{value:l,children:(0,r.jsx)(h.A,{value:v,children:t})})})}},67413:(e,t,n)=>{n.d(t,{A:()=>m});var a=n(55285),i=n(40644),s=n(93345),o=n(28919),l=n(37962),r=n(33571),c=n(39599),d=n(82858),u=n(74848);const h=["className","component"];function m(e={}){const{themeId:t,defaultTheme:n,defaultClassName:m="MuiBox-root",generateClassName:g}=e,p=(0,l.default)("div",{shouldForwardProp:e=>"theme"!==e&&"sx"!==e&&"as"!==e})(r.A);return s.forwardRef((function(e,s){const l=(0,d.A)(n),r=(0,c.A)(e),{className:v,component:f="div"}=r,C=(0,i.A)(r,h);return(0,u.jsx)(p,(0,a.A)({as:f,ref:s,className:(0,o.A)(v,g?g(m):m),theme:t&&l[t]||l},C))}))}}}]);