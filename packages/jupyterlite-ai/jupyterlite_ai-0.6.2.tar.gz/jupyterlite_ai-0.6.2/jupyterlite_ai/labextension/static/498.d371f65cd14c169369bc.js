"use strict";(self.webpackChunk_jupyterlite_ai=self.webpackChunk_jupyterlite_ai||[]).push([[498],{77498:(e,t,r)=>{r.r(t),r.d(t,{default:()=>ie});var o=r(36916),s=r(45551),i=r(50273),n=r(35263),a=r(76208),p=r(2653),c=r(42235),d=r(96820),l=r(5292),h=r(67262),m=r(74602);function u(e,t){return`${e}-${t}`}const g="@jupyterlite/ai:provider-registry",f=new h.Token("@jupyterlite/ai:provider-registry","Provider for chat and completion LLM provider"),y=g,v=e=>`\nYou are Jupyternaut, a conversational assistant living in JupyterLab to help users.\nYou are not a language model, but rather an application built on a foundation model from ${e.provider_name}.\nYou are talkative and you provide lots of specific details from the foundation model's context.\nYou may use Markdown to format your response.\nIf your response includes code, they must be enclosed in Markdown fenced code blocks (with triple backticks before and after).\nIf your response includes mathematical notation, they must be expressed in LaTeX markup and enclosed in LaTeX delimiters.\nAll dollar quantities (of USD) must be formatted in LaTeX, with the \`$\` symbol escaped by a single backslash \`\\\`.\n- Example prompt: \`If I have \\\\$100 and spend \\\\$20, how much money do I have left?\`\n- **Correct** response: \`You have \\(\\$80\\) remaining.\`\n- **Incorrect** response: \`You have $80 remaining.\`\nIf you do not know the answer to a question, answer truthfully by responding that you do not know.\nThe following is a friendly conversation between you and a human.\n`,_="\nYou are an application built to provide helpful code completion suggestions.\nYou should only produce code. Keep comments to minimum, use the\nprogramming language comment syntax. Produce clean code.\nThe code is written in JupyterLab, a data analysis and code development\nenvironment which can execute code extended with additional syntax for\ninteractive features, such as magics.\nOnly give raw strings back, do not format the response using backticks.\nThe output should be a single string, and should correspond to what a human users\nwould write.\nDo not include the prompt in the output, only the string that should be appended to the current input.\n";class b{constructor(e){this._currentProvider=null,this._completer=null,this._chatModel=null,this._name="None",this._providerChanged=new m.Signal(this),this._chatError="",this._completerError="",this._providers=new Map,this._deferredProvider=null,this._secretsManager=e.secretsManager||null,w.setToken(e.token)}get providers(){return Array.from(this._providers.keys())}add(e){var t;if(this._providers.has(e.name))throw new Error(`A AI provider named '${e.name}' is already registered`);this._providers.set(e.name,e),e.name===(null===(t=this._deferredProvider)||void 0===t?void 0:t.name)&&this.setProvider(this._deferredProvider)}get currentName(){return this._name}get currentCompleter(){return"None"===this._name?null:this._completer}get currentChatModel(){return"None"===this._name?null:this._chatModel}getSettingsSchema(e){var t,r;return(null===(r=null===(t=this._providers.get(e))||void 0===t?void 0:t.settingsSchema)||void 0===r?void 0:r.properties)||{}}getInstructions(e){var t;return null===(t=this._providers.get(e))||void 0===t?void 0:t.instructions}formatErrorMessage(e){var t,r;return(null===(t=this._currentProvider)||void 0===t?void 0:t.errorMessage)?null===(r=this._currentProvider)||void 0===r?void 0:r.errorMessage(e):e.message?e.message:e}get chatError(){return this._chatError}get completerError(){return this._completerError}async setProvider(e){var t,r,o,s;const{name:i,settings:n}=e;this._currentProvider=null!==(t=this._providers.get(i))&&void 0!==t?t:null,null===this._currentProvider?this._deferredProvider=e:this._deferredProvider=null;const a={};for(const e of Object.keys(n))if("***"!==n[e])a[e]=n[e];else{const t=u(i,e),o=await(null===(r=this._secretsManager)||void 0===r?void 0:r.get(w.getToken(),y,t));void 0!==o&&(a[e]=o.value)}if(void 0!==(null===(o=this._currentProvider)||void 0===o?void 0:o.completer))try{this._completer=new this._currentProvider.completer({settings:a}),this._completerError=""}catch(e){this._completerError=e.message}else this._completer=null;if(void 0!==(null===(s=this._currentProvider)||void 0===s?void 0:s.chatModel))try{this._chatModel=new this._currentProvider.chatModel({...a}),this._chatError=""}catch(e){this._chatError=e.message,this._chatModel=null}else this._chatModel=null;this._name=i,this._providerChanged.emit()}get providerChanged(){return this._providerChanged}}var w;!function(e){function t(e,t){const r=Object.getOwnPropertyDescriptor(e,t)||Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),t)||{};return Boolean(r.writable)}e.isWritable=t,e.updateConfig=function(e,r){Object.entries(r).forEach((([r,o],s)=>{if(r in e){const s=r;t(e,s)&&(e[s]=o)}}))}}(b||(b={})),function(e){let t;e.setToken=function(e){t=e},e.getToken=function(){return t}}(w||(w={}));const S=new c.LabIcon({name:"@jupyterlite/ai:jupyternaut-lite",svgstr:'<?xml version="1.0" encoding="UTF-8"?>\n<svg fill="none" version="1.1" viewBox="0 0 38 38" xmlns="http://www.w3.org/2000/svg">\n <g>\n  <circle cx="19" cy="19" r="19" fill="#f7dc1e"/>\n  <path d="m19.948 6.8365c0.6344-0.21603 1.0908-0.81693 1.0908-1.5244 0-0.88916-0.7208-1.61-1.61-1.61s-1.61 0.72081-1.61 1.61c0 0.70739 0.4562 1.3082 1.0905 1.5243v1.1674h-0.5394c-6.2858 0-11.399 5.1132-11.399 11.399 0 6.2859 5.1133 11.399 11.399 11.399h1.398c6.2859 0 11.399-5.1132 11.399-11.399 0-6.2253-5.0159-11.301-11.219-11.397v-1.1687zm-1.5781 22.163h1.398c5.3669 0 9.7303-4.9787 9.7303-8.3455 0-5.3669-4.3634-9.7303-9.7303-9.7303h-1.398c-5.3668 0-9.7302 4.3634-9.7302 9.7303 0 3.3668 4.3634 8.3455 9.7302 8.3455zm14.522-5.003c0.7341 0 0.7375-0.5123 0.7422-1.2408v-1e-4c0.0012-0.1847 0.0025-0.3833 0.0158-0.591 0.0573-0.8624 0.0739-1.7008 0.0573-2.4892l-0.0033-0.119c-0.0373-1.3318-0.0436-1.5579-1.3047-1.8058l-0.1479-0.0246 0.0015 0.0495c0.0076 0.2465 0.0151 0.493 0.0151 0.739 0 1.8018-0.2712 3.5478-0.773 5.189-0.1363 0.4459 0.3433 0.8629 0.7534 0.6411l0.6436-0.3481zm-27.612 0c-0.73409 0-0.73741-0.5123-0.74215-1.2407-0.0012-0.1848-0.00249-0.3834-0.01581-0.5912-0.0573-0.8624-0.07392-1.7007-0.05731-2.4892l0.00336-0.1189c0.03721-1.3319 0.04352-1.5579 1.3047-1.8058l0.14784-0.0247-0.00151 0.0495c-0.00756 0.2465-0.01511 0.493-0.01511 0.739 0 1.8019 0.27119 3.5478 0.773 5.189 0.13634 0.4459-0.34326 0.8629-0.7534 0.6411l-0.64361-0.3481zm14.242-12.005c-4.6297 0-8.4776 2.9361-9.4584 6.7577-0.13379 0.5212 0.5513 0.6935 0.877 0.2653 1.3829-1.818 3.1418-2.153 4.7068-2.4511 2.1143-0.4027 3.8746-0.7379 3.8746-4.5719z" clip-rule="evenodd" fill="#000" fill-rule="evenodd"/>\n </g>\n</svg>\n'}),x=`data:image/svg+xml;base64,${btoa(S.svgstr)}`;class C extends o.ChatModel{constructor(e){super(e),this._personaName="AI",this._errorMessage="",this._history={messages:[]},this._defaultErrorMessage="AI provider not configured",this._controller=null,this._providerRegistry=e.providerRegistry,this._prompt=v({provider_name:this._providerRegistry.currentName}),this._providerRegistry.providerChanged.connect((()=>{this._errorMessage=this._providerRegistry.chatError,this._prompt=v({provider_name:this._providerRegistry.currentName})}))}get provider(){return this._providerRegistry.currentChatModel}get personaName(){return this._personaName}set personaName(e){this.messages.forEach((t=>{if(t.sender.username===this._personaName){const r={...t};r.sender.username=e,this.messageAdded(r)}})),this._personaName=e}get prompt(){return this._prompt}set prompt(e){this._prompt=e}async sendMessage(e){var t;const r=e.body;if(r.startsWith("/clear"))return this.messagesDeleted(0,this.messages.length),this._history.messages=[],!1;e.id=h.UUID.uuid4();const o={id:e.id,body:r,sender:{username:"User"},time:Date.now(),type:"msg"};if(this.messageAdded(o),null===this._providerRegistry.currentChatModel){const e={id:h.UUID.uuid4(),body:`**${this._errorMessage?this._errorMessage:this._defaultErrorMessage}**`,sender:{username:"ERROR"},time:Date.now(),type:"msg"};return this.messageAdded(e),!1}this._history.messages.push(o);const s=(0,l.eu)([new l.tn(this._prompt)]);s.push(...this._history.messages.map((e=>"User"===e.sender.username?new l.xc(e.body):new l.Od(e.body))));const i={username:this._personaName,avatar_url:x};this.updateWriters([i]);const n={id:h.UUID.uuid4(),body:"",sender:i,time:Date.now(),type:"msg"};let a="";this._controller=new AbortController;try{for await(const e of await this._providerRegistry.currentChatModel.stream(s,{signal:this._controller.signal}))a+=null!==(t=e.content)&&void 0!==t?t:e,n.body=a,this.messageAdded(n);return this._history.messages.push(n),!0}catch(e){const t=this._providerRegistry.formatErrorMessage(e),r={id:h.UUID.uuid4(),body:`**${t}**`,sender:{username:"ERROR"},time:Date.now(),type:"msg"};return this.messageAdded(r),!1}finally{this.updateWriters([]),this._controller=null}}async getHistory(){return this._history}dispose(){super.dispose()}messageAdded(e){super.messageAdded(e)}stopStreaming(){var e;null===(e=this._controller)||void 0===e||e.abort()}}!function(e){e.ClearCommandProvider=class{constructor(){this.id="@jupyterlite/ai:clear-commands",this._slash_commands=[{name:"/clear",providerId:this.id,replaceWith:"/clear",description:"Clear the chat"}]}async getChatCommands(e){var t,r;const o=null===(r=null===(t=e.currentWord)||void 0===t?void 0:t.match(/^\/\w*/))||void 0===r?void 0:r[0];return o?this._slash_commands.filter((e=>e.name.startsWith(o))):[]}async handleChatCommand(e,t){}}}(C||(C={}));class k{constructor(e){this.identifier="@jupyterlite/ai",this._providerRegistry=e.providerRegistry,this._requestCompletion=e.requestCompletion,this._providerRegistry.providerChanged.connect((()=>{this.completer&&(this.completer.requestCompletion=this._requestCompletion)}))}get name(){return this._providerRegistry.currentName}get completer(){return this._providerRegistry.currentCompleter}async fetch(e,t){var r;return null===(r=this.completer)||void 0===r?void 0:r.fetch(e,t)}}var I=r(67525),T=r(16601),A=r(12963),P=r(49683);const M=/^```(?:[a-zA-Z]+)?\n?/,O=/```$/;var R=r(74583);const j=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","type":"object","properties":{"temperature":{"type":"number","description":"Amount of randomness injected into the response. Ranges from 0 to 1. Use temp closer to 0 for analytical / multiple choice, and temp closer to 1 for creative and generative tasks."},"topK":{"type":"number","description":"Only sample from the top K options for each subsequent token. Used to remove \\"long tail\\" low probability responses. Defaults to -1, which disables it."},"topP":{"type":"number","description":"Does nucleus sampling, in which we compute the cumulative distribution over all the options for each subsequent token in decreasing probability order and cut it off once it reaches a particular probability specified by top_p. Defaults to -1, which disables it. Note that you should either alter temperature or top_p, but not both."},"maxTokens":{"type":"number","description":"A maximum number of tokens to generate before stopping."},"maxTokensToSample":{"type":"number","description":"A maximum number of tokens to generate before stopping.","deprecated":"Use \\"maxTokens\\" instead."},"stopSequences":{"type":"array","items":{"type":"string"},"description":"A list of strings upon which to stop generating. You probably want `[\\"\\\\n\\\\nHuman:\\"]`, as that\'s the cue for the next turn in the dialog agent."},"streaming":{"type":"boolean","description":"Whether to stream the results or not"},"anthropicApiKey":{"type":"string","description":"Anthropic API key"},"apiKey":{"type":"string","description":"Anthropic API key"},"anthropicApiUrl":{"type":"string","description":"Anthropic API URL"},"modelName":{"type":"string","deprecated":"Use \\"model\\" instead"},"model":{"type":"string","description":"Model name to use"},"invocationKwargs":{"type":"object","description":"Holds any additional parameters that are valid to pass to  {@link  * https://console.anthropic.com/docs/api/reference | }      * `anthropic.messages`} that are not explicitly specified on this class."},"streamUsage":{"type":"boolean","description":"Whether or not to include token usage data in streamed chunks.","default":false}},"additionalProperties":false,"description":"Input to AnthropicChat class.","definitions":{}}'),N=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","type":"object","properties":{"concurrency":{"type":"number","deprecated":"Use `maxConcurrency` instead"},"topK":{"type":"number"},"temperature":{"type":"number"},"systemPrompt":{"type":"string"}},"additionalProperties":false,"definitions":{}}'),E=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","type":"object","properties":{"streamUsage":{"type":"boolean","description":"Whether or not to include token usage in the stream.","default":true},"disableStreaming":{"type":"boolean","description":"Whether to disable streaming.\\n\\nIf streaming is bypassed, then `stream()` will defer to `invoke()`.\\n\\n- If true, will always bypass streaming case.\\n- If false (default), will always use streaming case if available."},"apiKey":{"type":"string","description":"The API key to use.","default":""},"modelName":{"type":"string","description":"The name of the model to use. Alias for `model`","default":"mistral-small-latest"},"model":{"type":"string","description":"The name of the model to use.","default":"mistral-small-latest"},"endpoint":{"type":"string","description":"Override the default endpoint."},"temperature":{"type":"number","description":"What sampling temperature to use, between 0.0 and 2.0. Higher values like 0.8 will make the output more random, while lower values like 0.2 will make it more focused and deterministic.","default":0.7},"topP":{"type":"number","description":"Nucleus sampling, where the model considers the results of the tokens with `top_p` probability mass. So 0.1 means only the tokens comprising the top 10% probability mass are considered. Should be between 0 and 1.","default":1},"maxTokens":{"type":"number","description":"The maximum number of tokens to generate in the completion. The token count of your prompt plus max_tokens cannot exceed the model\'s context length."},"streaming":{"type":"boolean","description":"Whether or not to stream the response.","default":false},"safeMode":{"type":"boolean","description":"Whether to inject a safety prompt before all conversations.","default":false,"deprecated":"use safePrompt instead"},"safePrompt":{"type":"boolean","description":"Whether to inject a safety prompt before all conversations.","default":false},"randomSeed":{"type":"number","description":"The seed to use for random sampling. If set, different calls will generate deterministic results. Alias for `seed`"},"seed":{"type":"number","description":"The seed to use for random sampling. If set, different calls will generate deterministic results."}},"additionalProperties":false,"description":"Input to chat model class.","definitions":{}}'),q=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","type":"object","additionalProperties":false,"properties":{"disableStreaming":{"type":"boolean","description":"Whether to disable streaming.\\n\\nIf streaming is bypassed, then `stream()` will defer to `invoke()`.\\n\\n- If true, will always bypass streaming case.\\n- If false (default), will always use streaming case if available."},"logprobs":{"type":"boolean","description":"Whether to return log probabilities of the output tokens or not. If true, returns the log probabilities of each output token returned in the content of message."},"topLogprobs":{"type":"number","description":"An integer between 0 and 5 specifying the number of most likely tokens to return at each token position, each with an associated log probability. logprobs must be set to true if this parameter is used."},"prefixMessages":{"type":"array","items":{"anyOf":[{"type":"object","properties":{"content":{"anyOf":[{"type":"string"},{"type":"array","items":{"type":"object","properties":{"text":{"type":"string","description":"The text content."},"type":{"type":"string","const":"text","description":"The type of the content part."}},"required":["text","type"],"additionalProperties":false,"description":"Learn about [text inputs](https://platform.openai.com/docs/guides/text-generation)."}}],"description":"The contents of the developer message."},"role":{"type":"string","const":"developer","description":"The role of the messages author, in this case `developer`."},"name":{"type":"string","description":"An optional name for the participant. Provides the model information to differentiate between participants of the same role."}},"required":["content","role"],"additionalProperties":false,"description":"Developer-provided instructions that the model should follow, regardless of messages sent by the user. With o1 models and newer, `developer` messages replace the previous `system` messages."},{"type":"object","properties":{"content":{"anyOf":[{"type":"string"},{"type":"array","items":{"type":"object","properties":{"text":{"type":"string","description":"The text content."},"type":{"type":"string","const":"text","description":"The type of the content part."}},"required":["text","type"],"additionalProperties":false,"description":"Learn about [text inputs](https://platform.openai.com/docs/guides/text-generation)."}}],"description":"The contents of the system message."},"role":{"type":"string","const":"system","description":"The role of the messages author, in this case `system`."},"name":{"type":"string","description":"An optional name for the participant. Provides the model information to differentiate between participants of the same role."}},"required":["content","role"],"additionalProperties":false,"description":"Developer-provided instructions that the model should follow, regardless of messages sent by the user. With o1 models and newer, use `developer` messages for this purpose instead."},{"type":"object","properties":{"content":{"anyOf":[{"type":"string"},{"type":"array","items":{"anyOf":[{"type":"object","properties":{"text":{"type":"string","description":"The text content."},"type":{"type":"string","const":"text","description":"The type of the content part."}},"required":["text","type"],"additionalProperties":false,"description":"Learn about [text inputs](https://platform.openai.com/docs/guides/text-generation)."},{"type":"object","properties":{"image_url":{"type":"object","properties":{"url":{"type":"string","description":"Either a URL of the image or the base64 encoded image data."},"detail":{"type":"string","enum":["auto","low","high"],"description":"Specifies the detail level of the image. Learn more in the [Vision guide](https://platform.openai.com/docs/guides/vision#low-or-high-fidelity-image-understanding)."}},"required":["url"],"additionalProperties":false},"type":{"type":"string","const":"image_url","description":"The type of the content part."}},"required":["image_url","type"],"additionalProperties":false,"description":"Learn about [image inputs](https://platform.openai.com/docs/guides/vision)."},{"type":"object","properties":{"input_audio":{"type":"object","properties":{"data":{"type":"string","description":"Base64 encoded audio data."},"format":{"type":"string","enum":["wav","mp3"],"description":"The format of the encoded audio data. Currently supports \\"wav\\" and \\"mp3\\"."}},"required":["data","format"],"additionalProperties":false},"type":{"type":"string","const":"input_audio","description":"The type of the content part. Always `input_audio`."}},"required":["input_audio","type"],"additionalProperties":false,"description":"Learn about [audio inputs](https://platform.openai.com/docs/guides/audio)."}],"description":"Learn about [text inputs](https://platform.openai.com/docs/guides/text-generation)."}}],"description":"The contents of the user message."},"role":{"type":"string","const":"user","description":"The role of the messages author, in this case `user`."},"name":{"type":"string","description":"An optional name for the participant. Provides the model information to differentiate between participants of the same role."}},"required":["content","role"],"additionalProperties":false,"description":"Messages sent by an end user, containing prompts or additional context information."},{"type":"object","properties":{"role":{"type":"string","const":"assistant","description":"The role of the messages author, in this case `assistant`."},"audio":{"anyOf":[{"type":"object","properties":{"id":{"type":"string","description":"Unique identifier for a previous audio response from the model."}},"required":["id"],"additionalProperties":false,"description":"Data about a previous audio response from the model. [Learn more](https://platform.openai.com/docs/guides/audio)."},{"type":"null"}],"description":"Data about a previous audio response from the model. [Learn more](https://platform.openai.com/docs/guides/audio)."},"content":{"anyOf":[{"type":"string"},{"type":"array","items":{"anyOf":[{"type":"object","properties":{"text":{"type":"string","description":"The text content."},"type":{"type":"string","const":"text","description":"The type of the content part."}},"required":["text","type"],"additionalProperties":false,"description":"Learn about [text inputs](https://platform.openai.com/docs/guides/text-generation)."},{"type":"object","properties":{"refusal":{"type":"string","description":"The refusal message generated by the model."},"type":{"type":"string","const":"refusal","description":"The type of the content part."}},"required":["refusal","type"],"additionalProperties":false}]}},{"type":"null"}],"description":"The contents of the assistant message. Required unless `tool_calls` or `function_call` is specified."},"function_call":{"anyOf":[{"type":"object","properties":{"arguments":{"type":"string","description":"The arguments to call the function with, as generated by the model in JSON format. Note that the model does not always generate valid JSON, and may hallucinate parameters not defined by your function schema. Validate the arguments in your code before calling your function."},"name":{"type":"string","description":"The name of the function to call."}},"required":["arguments","name"],"additionalProperties":false,"deprecated":"Deprecated and replaced by `tool_calls`. The name and arguments of a\\nfunction that should be called, as generated by the model."},{"type":"null"}],"deprecated":"Deprecated and replaced by `tool_calls`. The name and arguments of a\\nfunction that should be called, as generated by the model."},"name":{"type":"string","description":"An optional name for the participant. Provides the model information to differentiate between participants of the same role."},"refusal":{"type":["string","null"],"description":"The refusal message by the assistant."},"tool_calls":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string","description":"The ID of the tool call."},"function":{"type":"object","properties":{"arguments":{"type":"string","description":"The arguments to call the function with, as generated by the model in JSON format. Note that the model does not always generate valid JSON, and may hallucinate parameters not defined by your function schema. Validate the arguments in your code before calling your function."},"name":{"type":"string","description":"The name of the function to call."}},"required":["arguments","name"],"additionalProperties":false,"description":"The function that the model called."},"type":{"type":"string","const":"function","description":"The type of the tool. Currently, only `function` is supported."}},"required":["id","function","type"],"additionalProperties":false},"description":"The tool calls generated by the model, such as function calls."}},"required":["role"],"additionalProperties":false,"description":"Messages sent by the model in response to user messages."},{"type":"object","properties":{"content":{"anyOf":[{"type":"string"},{"type":"array","items":{"type":"object","properties":{"text":{"type":"string","description":"The text content."},"type":{"type":"string","const":"text","description":"The type of the content part."}},"required":["text","type"],"additionalProperties":false,"description":"Learn about [text inputs](https://platform.openai.com/docs/guides/text-generation)."}}],"description":"The contents of the tool message."},"role":{"type":"string","const":"tool","description":"The role of the messages author, in this case `tool`."},"tool_call_id":{"type":"string","description":"Tool call that this message is responding to."}},"required":["content","role","tool_call_id"],"additionalProperties":false},{"type":"object","properties":{"content":{"type":["string","null"],"description":"The contents of the function message."},"name":{"type":"string","description":"The name of the function to call."},"role":{"type":"string","const":"function","description":"The role of the messages author, in this case `function`."}},"required":["content","name","role"],"additionalProperties":false,"deprecated":true}],"description":"Developer-provided instructions that the model should follow, regardless of messages sent by the user. With o1 models and newer, `developer` messages replace the previous `system` messages."},"description":"ChatGPT messages to pass as a prefix to the prompt"},"__includeRawResponse":{"type":"boolean","description":"Whether to include the raw OpenAI response in the output message\'s \\"additional_kwargs\\" field. Currently in experimental beta."},"supportsStrictToolCalling":{"type":"boolean","description":"Whether the model supports the `strict` argument when passing in tools. If `undefined` the `strict` argument will not be passed to OpenAI."},"modalities":{"type":"array","items":{"type":"string","enum":["text","audio"]},"description":"Output types that you would like the model to generate for this request. Most models are capable of generating text, which is the default:\\n\\n`[\\"text\\"]`\\n\\nThe `gpt-4o-audio-preview` model can also be used to [generate audio](https://platform.openai.com/docs/guides/audio). To request that this model generate both text and audio responses, you can use:\\n\\n`[\\"text\\", \\"audio\\"]`"},"audio":{"type":"object","properties":{"format":{"type":"string","enum":["wav","mp3","flac","opus","pcm16"],"description":"Specifies the output audio format. Must be one of `wav`, `mp3`, `flac`, `opus`, or `pcm16`."},"voice":{"type":"string","enum":["alloy","ash","ballad","coral","echo","sage","shimmer","verse"],"description":"The voice the model uses to respond. Supported voices are `ash`, `ballad`, `coral`, `sage`, and `verse` (also supported but not recommended are `alloy`, `echo`, and `shimmer`; these voices are less expressive)."}},"required":["format","voice"],"additionalProperties":false,"description":"Parameters for audio output. Required when audio output is requested with `modalities: [\\"audio\\"]`. [Learn more](https://platform.openai.com/docs/guides/audio)."},"reasoningEffort":{"type":"string","enum":["low","medium","high"],"description":"Constrains effort on reasoning for reasoning models. Currently supported values are low, medium, and high. Reducing reasoning effort can result in faster responses and fewer tokens used on reasoning in a response."},"temperature":{"type":"number","description":"Sampling temperature to use"},"maxTokens":{"type":"number","description":"Maximum number of tokens to generate in the completion. -1 returns as many tokens as possible given the prompt and the model\'s maximum context size."},"maxCompletionTokens":{"type":"number","description":"Maximum number of tokens to generate in the completion. -1 returns as many tokens as possible given the prompt and the model\'s maximum context size. Alias for `maxTokens` for reasoning models."},"topP":{"type":"number","description":"Total probability mass of tokens to consider at each step"},"frequencyPenalty":{"type":"number","description":"Penalizes repeated tokens according to frequency"},"presencePenalty":{"type":"number","description":"Penalizes repeated tokens"},"n":{"type":"number","description":"Number of completions to generate for each prompt"},"logitBias":{"type":"object","additionalProperties":{"type":"number"},"description":"Dictionary used to adjust the probability of specific tokens being generated"},"user":{"type":"string","description":"Unique string identifier representing your end-user, which can help OpenAI to monitor and detect abuse."},"streaming":{"type":"boolean","description":"Whether to stream the results or not. Enabling disables tokenUsage reporting"},"streamUsage":{"type":"boolean","description":"Whether or not to include token usage data in streamed chunks.","default":false},"modelName":{"type":"string","description":"Model name to use Alias for `model`","deprecated":"Use \\"model\\" instead."},"model":{"type":"string","description":"Model name to use"},"modelKwargs":{"type":"object","description":"Holds any additional parameters that are valid to pass to  {@link  * https://platform.openai.com/docs/api-reference/completions/create | }      * `openai.createCompletion`} that are not explicitly specified on this class."},"stop":{"type":"array","items":{"type":"string"},"description":"List of stop words to use when generating Alias for `stopSequences`"},"stopSequences":{"type":"array","items":{"type":"string"},"description":"List of stop words to use when generating"},"timeout":{"type":"number","description":"Timeout to use when making requests to OpenAI."},"openAIApiKey":{"type":"string","description":"API key to use when making requests to OpenAI. Defaults to the value of `OPENAI_API_KEY` environment variable. Alias for `apiKey`"},"apiKey":{"type":"string","description":"API key to use when making requests to OpenAI. Defaults to the value of `OPENAI_API_KEY` environment variable."}},"definitions":{}}'),U=[{name:"Anthropic",chatModel:I.ChatAnthropic,completer:class{constructor(e){this._prompt=_,this._completer=new I.ChatAnthropic({...e.settings})}get completer(){return this._completer}get prompt(){return this._prompt}set prompt(e){this._prompt=e}async fetch(e,t){const{text:r,offset:o}=e,s=r.slice(0,o),i=s.trim(),n=[new l.tn(this._prompt),new l.Od(i)];try{const e=await this._completer.invoke(n),t=[];return"string"==typeof e.content?t.push({insertText:e.content}):e.content.forEach((e=>{"text"===e.type&&t.push({insertText:e.text,filterText:s.substring(i.length)})})),{items:t}}catch(e){return console.error("Error fetching completions",e),{items:[]}}}},settingsSchema:j,errorMessage:e=>e.error.error.message},{name:"ChromeAI",chatModel:T.L,completer:class{constructor(e){this._prompt=_,this._completer=new T.L({...e.settings})}get prompt(){return this._prompt}set prompt(e){this._prompt=e}get completer(){return this._completer}async fetch(e,t){const{text:r,offset:o}=e,s=r.slice(0,o).trim(),i=[new l.tn(this._prompt),new l.xc(s)];try{let e=await this._completer.invoke(i);return M.test(e)&&(e=e.replace(M,"").replace(O,"")),{items:[{insertText:e}]}}catch(e){return console.error("Error fetching completion:",e),{items:[]}}}},instructions:'\n<i class="fas fa-exclamation-triangle"></i> Support for ChromeAI is still experimental and only available in Google Chrome.\n\nYou can test ChromeAI is enabled in your browser by going to the following URL: <https://chromeai.org/>\n\nEnable the proper flags in Google Chrome.\n\n- chrome://flags/#prompt-api-for-gemini-nano\n  - Select: `Enabled`\n- chrome://flags/#optimization-guide-on-device-model\n  - Select: `Enabled BypassPrefRequirement`\n- chrome://components\n  - Click `Check for Update` on Optimization Guide On Device Model to download the model\n- [Optional] chrome://flags/#text-safety-classifier\n\n<img src="https://github.com/user-attachments/assets/d48f46cc-52ee-4ce5-9eaf-c763cdbee04c" alt="A screenshot showing how to enable the ChromeAI flag in Google Chrome" width="500px">\n\nThen restart Chrome for these changes to take effect.\n\n<i class="fas fa-exclamation-triangle"></i> On first use, Chrome will download the on-device model, which can be as large as 22GB (according to their docs and at the time of writing).\nDuring the download, ChromeAI may not be available via the extension.\n\n<i class="fa fa-info-circle" aria-hidden="true"></i> For more information about Chrome Built-in AI: <https://developer.chrome.com/docs/ai/get-started>\n',settingsSchema:N},{name:"MistralAI",chatModel:A.ChatMistralAI,completer:class{constructor(e){this._prompt=_,this._completer=new A.ChatMistralAI({...e.settings}),this._throttler=new R.Throttler((async e=>{const t=await this._completer.invoke(e),r=[];return"string"==typeof t.content?r.push({insertText:t.content}):t.content.forEach((e=>{"text"===e.type&&r.push({insertText:e.text})})),{items:r}}),{limit:1e3})}get completer(){return this._completer}get prompt(){return this._prompt}set prompt(e){this._prompt=e}async fetch(e,t){const{text:r,offset:o}=e,s=r.slice(0,o),i=[new l.tn(this._prompt),new l.xc(s)];try{return await this._throttler.invoke(i)}catch(e){return console.error("Error fetching completions",e),{items:[]}}}},instructions:'\n<i class="fas fa-exclamation-triangle"></i> This extension is still very much experimental. It is not an official MistralAI extension.\n\n1. Go to <https://console.mistral.ai/api-keys/> and create an API key.\n\n    <img src="https://raw.githubusercontent.com/jupyterlite/ai/refs/heads/main/img/1-api-key.png" alt="Screenshot showing how to create an API key" width="500px">\n\n2. Open the JupyterLab settings and go to the **Ai providers** section to select the `MistralAI`\n   provider and the API key (required).\n\n    <img src="https://raw.githubusercontent.com/jupyterlite/ai/refs/heads/main/img/2-jupyterlab-settings.png" alt="Screenshot showing how to add the API key to the settings" width="500px">\n\n3. Open the chat, or use the inline completer\n\n    <img src="https://raw.githubusercontent.com/jupyterlite/ai/refs/heads/main/img/3-usage.png" alt="Screenshot showing how to use the chat" width="500px">\n',settingsSchema:E},{name:"OpenAI",chatModel:P.ChatOpenAI,completer:class{constructor(e){this._prompt=_,this._completer=new P.ChatOpenAI({...e.settings})}get completer(){return this._completer}get prompt(){return this._prompt}set prompt(e){this._prompt=e}async fetch(e,t){const{text:r,offset:o}=e,s=r.slice(0,o),i=[new l.tn(this._prompt),new l.Od(s)];try{const e=await this._completer.invoke(i),t=[];return"string"==typeof e.content?t.push({insertText:e.content}):e.content.forEach((e=>{"text"===e.type&&t.push({insertText:e.text,filterText:s.substring(s.length)})})),{items:t}}catch(e){return console.error("Error fetching completions",e),{items:[]}}}},settingsSchema:q}].map((e=>({id:`@jupyterlite/ai:${e.name}`,autoStart:!0,requires:[f],activate:(t,r)=>{r.add(e)}})));var D=r(57165),L=r.n(D),W=r(93345),J=r.n(W),$=r(3266),F=r(34801),z=r(10701);class K extends F.DataConnector{constructor(e){super(),this._doNotSave=[],this._throttlers=Object.create(null),this._connector=e}set doNotSave(e){this._doNotSave=[...e]}fetch(e){const t=this._throttlers;return e in t||(t[e]=new R.Throttler((()=>this._connector.fetch(e)),100)),t[e].invoke()}async list(e="all"){const{isDisabled:t}=$.PageConfig.Extension,{ids:r,values:o}=await this._connector.list("ids"===e?"ids":void 0);return"all"===e?{ids:r,values:o}:"ids"===e?{ids:r}:{ids:r.filter((e=>!t(e))),values:o.filter((({id:e})=>!t(e)))}}async save(e,t){const r=z.parse(t);this._doNotSave.forEach((e=>{void 0!==r.AIprovider&&(r.AIprovider[e]="***")})),await this._connector.save(e,z.stringify(r,null,2))}}const Y=JSON.parse('{"title":"AI provider","description":"Provider settings","type":"object","properties":{},"additionalProperties":false}'),B="text/markdown",G="@jupyterlite/ai:settings",H=g,V=e=>J().createElement(c.FormComponent,{...e,validator:L()});class X extends J().Component{constructor(e){var t,r,o,s,i,n;if(super(e),this._updateUseSecretsManager=e=>{var t;if(this._useSecretsManager=e,e){const e=JSON.parse(localStorage.getItem(G)||"{}");Object.keys(e).forEach((t=>{Object.keys(e[t]).filter((e=>e.toLowerCase().includes("key"))).forEach((r=>{delete e[t][r]}))})),localStorage.setItem(G,JSON.stringify(e)),this._settingConnector instanceof K&&(this._settingConnector.doNotSave=this._secretFields),this.componentDidUpdate()}else null===(t=this._secretsManager)||void 0===t||t.detachAll(Z.getToken(),H),this._settingConnector instanceof K&&(this._settingConnector.doNotSave=[]),this.saveSettings(this._currentSettings);this._settings.set("AIprovider",{provider:this._provider,...this._currentSettings}).catch(console.error)},this._onProviderChanged=e=>{const t=e.formData.provider;t!==this._currentSettings.provider&&(this._provider=t,this.saveCurrentProvider(),this._currentSettings=this.getSettings(),this._updateSchema(),this._renderInstruction(),this._settings.set("AIprovider",{provider:this._provider,...this._currentSettings}).catch(console.error))},this._onPasswordUpdated=(e,t)=>{this._currentSettings[e]=t,this._settings.set("AIprovider",{provider:this._provider,...this._currentSettings}).catch(console.error)},this._onFormChange=e=>{this._currentSettings=h.JSONExt.deepCopy(e.formData),this.saveSettings(this._currentSettings),this._settings.set("AIprovider",{provider:this._provider,...this._currentSettings}).catch(console.error)},this._currentSettings={provider:"None"},this._uiSchema={},this._formRef=J().createRef(),this._secretFields=[],!e.formContext.providerRegistry)throw new Error("The provider registry is needed to enable the jupyterlite-ai settings panel");this._providerRegistry=e.formContext.providerRegistry,this._rmRegistry=null!==(t=e.formContext.rmRegistry)&&void 0!==t?t:null,this._secretsManager=null!==(r=e.formContext.secretsManager)&&void 0!==r?r:null,this._settingConnector=null!==(o=e.formContext.settingConnector)&&void 0!==o?o:null,this._settings=e.formContext.settings,this._useSecretsManager=null===(s=this._settings.get("UseSecretsManager").composite)||void 0===s||s,this._hideSecretFields=null===(i=this._settings.get("HideSecretFields").composite)||void 0===i||i;const a=h.JSONExt.deepCopy(Y);if(a.properties.provider={type:"string",title:"Provider",description:"The AI provider to use for chat and completion",default:"None",enum:["None"].concat(this._providerRegistry.providers)},this._providerSchema=a,null===localStorage.getItem(G)){const e=this._settings.get("AIprovider").composite;if(e&&Object.keys(e).includes("provider")){const t=null===(n=Object.entries(e).find((e=>"provider"===e[0])))||void 0===n?void 0:n[1],r={_current:t};r[t]=e,localStorage.setItem(G,JSON.stringify(r))}}this._provider=this.getCurrentProvider(),this._currentSettings=this.getSettings();const p=this._buildSchema();this.state={schema:p,instruction:null},this._renderInstruction(),this._settings.set("AIprovider",this._currentSettings).catch(console.error),this._settings.changed.connect((()=>{var e,t;const r=null===(e=this._settings.get("UseSecretsManager").composite)||void 0===e||e;r!==this._useSecretsManager&&this._updateUseSecretsManager(r);const o=null===(t=this._settings.get("HideSecretFields").composite)||void 0===t||t;o!==this._hideSecretFields&&(this._hideSecretFields=o,this._updateSchema())}))}async componentDidUpdate(){var e;if(!this._secretsManager||!this._useSecretsManager)return;await this._secretsManager.detachAll(Z.getToken(),H);const t=(null===(e=this._formRef.current)||void 0===e?void 0:e.getElementsByTagName("input"))||[];for(let e=0;e<t.length;e++)if("password"===t[e].type.toLowerCase()){const r=t[e].getAttribute("label");if(r){const o=u(this._provider,r);this._secretsManager.attach(Z.getToken(),H,o,t[e],(e=>this._onPasswordUpdated(r,e)))}}}componentWillUnmount(){this._secretsManager&&this._useSecretsManager&&this._secretsManager.detachAll(Z.getToken(),H)}getCurrentProvider(){var e;return null!==(e=JSON.parse(localStorage.getItem(G)||"{}")._current)&&void 0!==e?e:"None"}saveCurrentProvider(){const e=JSON.parse(localStorage.getItem(G)||"{}");e._current=this._provider,localStorage.setItem(G,JSON.stringify(e))}getSettings(){var e;return null!==(e=JSON.parse(localStorage.getItem(G)||"{}")[this._provider])&&void 0!==e?e:{provider:this._provider}}saveSettings(e){var t;const r={...e},o=JSON.parse(null!==(t=localStorage.getItem(G))&&void 0!==t?t:"{}");this._secretsManager&&this._useSecretsManager&&this._secretFields.forEach((e=>delete r[e])),o[this._provider]=r,localStorage.setItem(G,JSON.stringify(o))}_buildSchema(){const e=h.JSONExt.deepCopy(Y);this._uiSchema={};const t=this._providerRegistry.getSettingsSchema(this._provider);return this._secretFields=[],t&&Object.entries(t).forEach((([t,r])=>{if(t.toLowerCase().includes("key")){if(this._secretFields.push(t),this._hideSecretFields)return;this._uiSchema[t]={"ui:widget":"password"}}e.properties[t]=r})),this._secretsManager&&this._useSecretsManager&&this._settingConnector instanceof K&&(this._settingConnector.doNotSave=this._secretFields),e}_updateSchema(){const e=this._buildSchema();this.setState({schema:e})}async _renderInstruction(){let e=this._providerRegistry.getInstructions(this._provider);if(!this._rmRegistry||!e)return void this.setState({instruction:null});e=`---\n\n${e}\n\n---`;const t=this._rmRegistry.createRenderer(B),r=this._rmRegistry.createModel({data:{[B]:e}});await t.renderModel(r),this.setState({instruction:t.node})}render(){return J().createElement("div",{ref:this._formRef},J().createElement(V,{formData:{provider:this._provider},schema:this._providerSchema,onChange:this._onProviderChanged}),null!==this.state.instruction&&J().createElement("details",null,J().createElement("summary",{className:"jp-AISettingsInstructions"},"Instructions"),J().createElement("span",{ref:e=>e&&e.replaceChildren(this.state.instruction)})),J().createElement(V,{formData:this._currentSettings,schema:this.state.schema,onChange:this._onFormChange,uiSchema:this._uiSchema}))}}var Z;!function(e){let t;e.setToken=function(e){t=e},e.getToken=function(){return t}}(Z||(Z={}));var Q=r(59257);const ee={id:"@jupyterlite/ai:autocompletion-registry",description:"Autocompletion registry",autoStart:!0,provides:o.IChatCommandRegistry,activate:()=>{const e=new o.ChatCommandRegistry;return e.addProvider(new C.ClearCommandProvider),e}},te={id:"@jupyterlite/ai:chat",description:"LLM chat extension",autoStart:!0,requires:[f,a.IRenderMimeRegistry,o.IChatCommandRegistry],optional:[n.INotebookTracker,p.ISettingRegistry,s.IThemeManager],activate:async(e,t,r,s,i,n,a)=>{let p=null;i&&(p=new o.ActiveCellManager({tracker:i,shell:e.shell}));const c=new C({providerRegistry:t,activeCellManager:p});let d=!1,l=!0,h="AI";function m(e){d=e.get("sendWithShiftEnter").composite,l=e.get("enableCodeToolbar").composite,h=e.get("personaName").composite,c.config={sendWithShiftEnter:d,enableCodeToolbar:l},c.personaName=h}Promise.all([e.restored,null==n?void 0:n.load(te.id)]).then((([,e])=>{e?(m(e),e.changed.connect(m)):console.warn("The SettingsRegistry is not loaded for the chat extension")})).catch((e=>{console.error(`Something went wrong when reading the settings.\n${e}`)}));let u=null;const g=o.InputToolbarRegistry.defaultToolbarRegistry(),f=(y=()=>c.stopStreaming(),{element:e=>function(e){const t="Stop streaming";return J().createElement(o.TooltippedButton,{onClick:e.stopStreaming,tooltip:t,buttonProps:{size:"small",variant:"contained",title:t}},J().createElement(Q.A,null))}({...e,stopStreaming:y}),position:50,hidden:!0});var y;g.addItem("stop",f),c.writersChanged.connect(((e,t)=>{t.filter((e=>e.username===c.personaName)).length?(g.hide("send"),g.show("stop")):(g.hide("stop"),g.show("send"))}));try{u=(0,o.buildChatSidebar)({model:c,themeManager:a,rmRegistry:r,chatCommandRegistry:s,inputToolbarRegistry:g}),u.title.caption="Jupyterlite AI Chat"}catch(e){u=(0,o.buildErrorWidget)(a)}e.shell.add(u,"left",{rank:2e3}),console.log("Chat extension initialized")}},re={id:"@jupyterlite/ai:completer",autoStart:!0,requires:[f,i.ICompletionProviderManager],activate:(e,t,r)=>{const o=new k({providerRegistry:t,requestCompletion:()=>e.commands.execute("inline-completer:invoke")});r.registerInlineProvider(o)}},oe=d.SecretsManager.sign(g,(e=>({id:g,autoStart:!0,requires:[c.IFormRendererRegistry,p.ISettingRegistry],optional:[a.IRenderMimeRegistry,d.ISecretsManager,p.ISettingConnector],provides:f,activate:(t,r,o,s,i,n)=>{const a=new b({token:e,secretsManager:i});return r.addRenderer(`${g}.AIprovider`,(e=>{const{secretsToken:t}=e;return delete e.secretsToken,t&&Z.setToken(t),{fieldRenderer:t=>(t.formContext={...t.formContext,...e},J().createElement(X,{...t}))}})({providerRegistry:a,secretsToken:e,rmRegistry:s,secretsManager:i,settingConnector:n})),o.load(oe.id).then((e=>{const t=()=>{var t;const r=null!==(t=e.get("AIprovider").composite)&&void 0!==t?t:{provider:"None"};a.setProvider({name:r.provider,settings:r})};e.changed.connect((()=>t())),t()})).catch((e=>{console.error(`Failed to load settings for ${oe.id}`,e)})),a}}))),se={id:"@jupyterlite/ai:settings-connector",description:"Provides a settings connector which does not save passwords.",autoStart:!0,provides:p.ISettingConnector,activate:e=>new K(e.serviceManager.settings)},ie=[oe,ee,te,re,se,...U]}}]);